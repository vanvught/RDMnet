<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  <meta name="generator" content="Doxygen 1.8.13" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RDMnet: Using the Controller API</title>
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <link href="stylesheet.css" rel="stylesheet" type="text/css" />
  <!--BEGIN CUSTOM SCRIPTS-->
  <script type="text/javascript">
    $(function () {
      $.get('/RDMnet/docs/versions.txt', function (data) {
        if (data) {
          var lines = data.split('\n');
          if (lines.length > 0) {
            var version_select = $("#version_select").empty();
            lines.forEach(function (line) {
              line = line.trim();
              if (!line) {
                return;
              }
              line = line.split(':');
              var option_name = line[0].replace(/^v/, '');
              if (line.length > 1) {
                option_name += ' (' + line[1] + ')';
              }
              var option_val = '/RDMnet/docs/' + line[0];
              var option = $('<option></option>').attr("value", option_val)
                .text(option_name);
              if (window.location.pathname.match('docs/' + line[0])) {
                option = option.attr("selected", "selected");
              }
              version_select.append(option);
            });
          }
        }
      }, 'text');
    });
  </script>
  <script type="text/javascript">
    $(function () { selectAllC() });
  </script>
  <script type="text/javascript">
    function selectAllC() {
      // Enable all C-language blocks
      var tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
        if (tabcontent[i].id.endsWith("_c")) {
          tabcontent[i].style.display = "block";
        } else {
          tabcontent[i].style.display = "none"
        }
      }
      // Enable all C-language buttons
      var tablinks = document.getElementsByClassName("tablinks");
      for (i = 0; i < tablinks.length; i++) {
        if (tablinks[i].id.endsWith("_c")) {
          if (!tablinks[i].className.includes("active")) {
            tablinks[i].className = tablinks[i].className += " active";
          }
        } else {
          tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
      }
    }
    function selectAllCpp() {
      // Enable all C++-language blocks
      var tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
        if (tabcontent[i].id.endsWith("_cpp")) {
          tabcontent[i].style.display = "block";
        } else {
          tabcontent[i].style.display = "none"
        }
      }
      // Enable all C++-language buttons
      var tablinks = document.getElementsByClassName("tablinks");
      for (i = 0; i < tablinks.length; i++) {
        if (tablinks[i].id.endsWith("_cpp")) {
          if (!tablinks[i].className.includes("active")) {
            tablinks[i].className = tablinks[i].className += " active";
          }
        } else {
          tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
      }
    }
    function selectLanguage(evt, block_id, language) {
      // Get all elements with class="tabcontent" and hide them
      var tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
        if (tabcontent[i].id.startsWith("div_" + block_id)) {
          tabcontent[i].style.display = "none";
        }
      }
      // Get all elements with class="tablinks" and remove the class "active"
      var tablinks = document.getElementsByClassName("tablinks");
      for (i = 0; i < tablinks.length; i++) {
        if (tablinks[i].id.startsWith("button_" + block_id)) {
          tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
      }
      // Show the current tab, and add an "active" class to the button that opened the tab
      document.getElementById("div_" + block_id + "_" + language).style.display = "block";
      if (!evt.currentTarget.className.includes("active")) {
        evt.currentTarget.className += " active";
      }
    }
  </script>
  <!--END CUSTOM SCRIPT-->
</head>
<body>
  <div id="top">
    <!-- do not remove this div, it is closed by doxygen! -->
    <div id="titlearea">
      <table cellspacing="0" cellpadding="0" style="width: 100%">
        <tbody>
          <tr style="height: 56px;">
            <td id="projectalign" style="padding-left: 0.5em;">
              <div id="projectname">RDMnet
                &#160;<span id="projectnumber">Staging for pull request 34</span>
              </div>
              <div id="projectbrief">Implementation of ANSI E1.33 (RDMnet)</div>
            </td>
            <!--BEGIN CUSTOM INSERTED SECTION-->
            <td style="text-align: right; padding-right: 0.5em">
              <div id="otherversions">
                View other versions:
                <select id="version_select" onchange="location = this.value">
                </select>
              </div>
            </td>
            <!--END CUSTOM INSERTED SECTION-->
          </tr>
        </tbody>
      </table>
    </div>
    <!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('using_controller.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Using the Controller API </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The RDMnet Controller API exposes both a C and C++ language interface. The C++ interface is a header-only wrapper around the C interface.</p>
<p> 
<div class="tab">
  <button id="button_1_c" class="tablinks" onclick="selectAllC()">Show All C Snippets</button>
  <button id="button_1_cpp" class="tablinks" onclick="selectAllCpp()">Show All C++ Snippets</button>
</div>
</p>
<h2>Initialization</h2>
<p>The RDMnet library must be globally initialized before using the RDMnet controller API. See <a class="el" href="global_init_and_destroy.html">Global Initialization and Destruction</a>.</p>
<p>To create a controller instance, use the <a class="el" href="group__rdmnet__controller.html#ga1860f48d433795826ce3edc8f6963c51" title="Create a new instance of RDMnet controller functionality. ">rdmnet_controller_create()</a> function in C, or instantiate an <a class="el" href="classrdmnet_1_1_controller.html" title="An instance of RDMnet controller functionality. ">rdmnet::Controller</a> and call its Startup() function in C++. Most apps will only need a single controller instance. One controller can monitor an arbitrary number of RDMnet scopes at once.</p>
<p>The RDMnet controller API is an asynchronous, callback-oriented API. Part of the initial configuration for a controller instance is a set of function pointers (or abstract interface) for the library to use as callbacks. Callbacks are dispatched from the background thread that is started when the RDMnet library is initialized.</p>
<p> 
<div class="tab">
  <button id="button_2_c" class="tablinks" onclick="selectLanguage(event, '2', 'c')">C</button>
  <button id="button_2_cpp" class="tablinks" onclick="selectLanguage(event, '2', 'cpp')">C++</button>
</div>
<div id="div_2_c" class="tabcontent">
</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="controller_8h.html">rdmnet/controller.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="comment">// Sets optional values to defaults. Must pass your ESTA manufacturer ID. If you have not yet</span></div><div class="line"><span class="comment">// requested an ESTA manufacturer ID, the range 0x7ff0 to 0x7fff can be used for prototyping.</span></div><div class="line"><a class="code" href="struct_rdmnet_controller_config.html">RdmnetControllerConfig</a> config = <a class="code" href="group__rdmnet__controller.html#gab61905ff5228301100c6d70c58e77661">RDMNET_CONTROLLER_CONFIG_DEFAULT_INIT</a>(MY_ESTA_MANUFACTURER_ID_VAL);</div><div class="line"></div><div class="line"><span class="comment">// Each controller is a component that must have a Component ID (CID), which is simply a UUID.</span></div><div class="line"><span class="comment">// Software should generate and save a CID so that the same one is used on each run of the software.</span></div><div class="line"><a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/group__etcpal__uuid.html#gabb977b5a218b4b62224c016bf3932f10">etcpal_generate_os_preferred_uuid</a>(&amp;config.<a class="code" href="struct_rdmnet_controller_config.html#a88afa036a301ef655052aaf77bbe013e">cid</a>);</div><div class="line"></div><div class="line"><span class="comment">// Set the callback functions - defined elsewhere</span></div><div class="line"><span class="comment">// p_some_opaque_data is an opaque data pointer that will be passed back to each callback function</span></div><div class="line"><a class="code" href="group__rdmnet__controller.html#ga561941b5e39514b8015e936130c6e544">rdmnet_controller_set_callbacks</a>(&amp;config, my_controller_connected_cb, my_controller_connect_failed_cb,</div><div class="line">                                my_controller_disconnected_cb, my_controller_client_list_update_received_cb,</div><div class="line">                                my_controller_rdm_response_received_cb, my_controller_status_received_cb,</div><div class="line">                                p_some_opaque_data);</div><div class="line"></div><div class="line"><span class="comment">// Needed to identify this controller to other controllers on the network. More on this later.</span></div><div class="line"><a class="code" href="group__rdmnet__controller.html#gabe33db1a11bf3b2b14e7c7a51f612a42">rdmnet_controller_set_rdm_data</a>(&amp;config, <span class="stringliteral">&quot;My Manufacturer Name&quot;</span>, <span class="stringliteral">&quot;My Product Name&quot;</span>, <span class="stringliteral">&quot;1.0.0&quot;</span>, <span class="stringliteral">&quot;My Device Label&quot;</span>, <span class="keyword">true</span>);</div><div class="line"></div><div class="line"><a class="code" href="group__rdmnet__controller.html#gae857478c160127b99ef4c092ac608fcb">rdmnet_controller_t</a> my_controller_handle;</div><div class="line"><a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/group__etcpal__error.html#ga743b0648f0ca798ef29c9f69c6e255af">etcpal_error_t</a> result = <a class="code" href="group__rdmnet__controller.html#ga1860f48d433795826ce3edc8f6963c51">rdmnet_controller_create</a>(&amp;config, &amp;my_controller_handle);</div><div class="line"><span class="keywordflow">if</span> (result == <a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/group__etcpal__error.html#gga743b0648f0ca798ef29c9f69c6e255afae403d046b4ba4e81dce121266c2cca8d">kEtcPalErrOk</a>)</div><div class="line">{</div><div class="line">  <span class="comment">// Handle is valid and may be referenced in later calls to API functions.</span></div><div class="line">}</div><div class="line"><span class="keywordflow">else</span></div><div class="line">{</div><div class="line">  printf(<span class="stringliteral">&quot;RDMnet controller creation failed with error: %s\n&quot;</span>, <a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/group__etcpal__error.html#ga4902a840d9801e02baebd4c70924c4b0">etcpal_strerror</a>(result));</div><div class="line">}</div></div><!-- fragment --><p> 
</div>
<div id="div_2_cpp" class="tabcontent">
</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;<a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/cpp_2uuid_8h.html">etcpal/cpp/uuid.h</a>&quot;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="cpp_2controller_8h.html">rdmnet/cpp/controller.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="keyword">class </span>MyControllerNotifyHandler : <span class="keyword">public</span> <a class="code" href="classrdmnet_1_1_controller_1_1_notify_handler.html">rdmnet::Controller::NotifyHandler</a></div><div class="line">{</div><div class="line">  <span class="comment">// Implement the NotifyHandler callbacks...</span></div><div class="line">};</div><div class="line"></div><div class="line">MyControllerNotifyHandler my_controller_notify_handler;</div><div class="line"></div><div class="line"><span class="comment">// Each controller is a component that must have a Component ID (CID), which is simply a UUID.</span></div><div class="line"><span class="comment">// Software should generate and save a CID so that the same one is used on each run of the software.</span></div><div class="line"><a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/classetcpal_1_1_uuid.html">etcpal::Uuid</a> my_cid = <a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/classetcpal_1_1_uuid.html#ae1ccf480526751a937afb32a2db7346a">etcpal::Uuid::OsPreferred</a>();</div><div class="line"></div><div class="line"><span class="comment">// Contains the configuration settings that the controller needs to operate. Some of these are set</span></div><div class="line"><span class="comment">// to default values and can be changed if necessary. Must pass your ESTA manufacturer ID. If you</span></div><div class="line"><span class="comment">// have not yet requested an ESTA manufacturer ID, the range 0x7ff0 to 0x7fff can be used for</span></div><div class="line"><span class="comment">// prototyping.</span></div><div class="line"><a class="code" href="structrdmnet_1_1_controller_1_1_settings.html">rdmnet::Controller::Settings</a> my_settings(my_cid, MY_ESTA_MANUFACTURER_ID_VAL);</div><div class="line"></div><div class="line"><span class="comment">// Needed to identify this controller to other controllers on the network. More on this later.</span></div><div class="line"><a class="code" href="structrdmnet_1_1_controller_1_1_rdm_data.html">rdmnet::Controller::RdmData</a> my_rdm_data(<span class="stringliteral">&quot;My Manufacturer Name&quot;</span>,</div><div class="line">                                        <span class="stringliteral">&quot;My Product Name&quot;</span>,</div><div class="line">                                        <span class="stringliteral">&quot;1.0.0&quot;</span>,</div><div class="line">                                        <span class="stringliteral">&quot;My Device Label&quot;</span>);</div><div class="line"><a class="code" href="classrdmnet_1_1_controller.html">rdmnet::Controller</a> controller;</div><div class="line"><a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/classetcpal_1_1_error.html">etcpal::Error</a> result = controller.<a class="code" href="classrdmnet_1_1_controller.html#a1d0150d73e64cfff241b351f7b8efd55">Startup</a>(my_controller_notify_handler, my_settings, my_rdm_data);</div><div class="line"><span class="keywordflow">if</span> (result)</div><div class="line">{</div><div class="line">  <span class="comment">// Controller is valid and running.</span></div><div class="line">  <a class="code" href="classrdmnet_1_1_controller.html#a585adefdd50c5a7bc63d3a5625889c7d">rdmnet::Controller::Handle</a> handle = controller.<a class="code" href="classrdmnet_1_1_controller.html#a017fffa80881b13ac10fe49078898adf">handle</a>();</div><div class="line">  <span class="comment">// Store handle for later lookup from the NotifyHandler callback functions.</span></div><div class="line">}</div><div class="line"><span class="keywordflow">else</span></div><div class="line">{</div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;RDMnet controller startup failed with error: &quot;</span> &lt;&lt; result.<a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/classetcpal_1_1_error.html#a19c380b03cea21d7ac7325136a131ff0">ToString</a>() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div><div class="line">}</div></div><!-- fragment --><p> 
</div>
</p>
<h2>Deinitialization</h2>
<p>The controller should be shut down and destroyed gracefully before program termination. This will send a graceful disconnect message to any connected brokers and deallocate the controller's resources.</p>
<p> 
<div class="tab">
  <button id="button_3_c" class="tablinks" onclick="selectLanguage(event, '3', 'c')">C</button>
  <button id="button_3_cpp" class="tablinks" onclick="selectLanguage(event, '3', 'cpp')">C++</button>
</div>
<div id="div_3_c" class="tabcontent">
</p>
<div class="fragment"><div class="line"><a class="code" href="group__rdmnet__controller.html#ga69f5287dd825ac492abe10847189d777">rdmnet_controller_destroy</a>(my_controller_handle, <a class="code" href="group__rdmnet__api__common.html#gga3eb1adaf6e830a807d1dcfbc64197222a336a46d8d36f5b1f32fac4653913cdd2">kRdmnetDisconnectShutdown</a>);</div><div class="line"></div><div class="line"><span class="comment">// At this point, the controller is no longer running and its handle is no longer valid.</span></div></div><!-- fragment --><p> 
</div>
<div id="div_3_cpp" class="tabcontent">
</p>
<div class="fragment"><div class="line">controller.<a class="code" href="classrdmnet_1_1_controller.html#a05affd966d0250020eaba3ceb39bbd8d">Shutdown</a>();</div><div class="line"></div><div class="line"><span class="comment">// At this point, the controller is no longer running and its handle is no longer valid. It can be</span></div><div class="line"><span class="comment">// started again (with a new handle) by calling Startup() again.</span></div></div><!-- fragment --><p> 
</div>
</p>
<h2>Managing Scopes</h2>
<p>A controller instance is initially created without any configured scopes. If the app has not been reconfigured by a user, the E1.33 RDMnet standard requires that the RDMnet default scope be configured automatically. There is a shortcut function for this. Otherwise, you can add a custom scope.</p>
<p>Per the requirements of RDMnet, a scope string is always UTF-8 and is thus represented by a char[] in C and a std::string in C++.</p>
<p>See the "Scopes" section in <a class="el" href="how_it_works.html">How RDMnet Works</a> for more information on scopes.</p>
<p> 
<div class="tab">
  <button id="button_4_c" class="tablinks" onclick="selectLanguage(event, '4', 'c')">C</button>
  <button id="button_4_cpp" class="tablinks" onclick="selectLanguage(event, '4', 'cpp')">C++</button>
</div>
<div id="div_4_c" class="tabcontent">
</p>
<div class="fragment"><div class="line"><span class="comment">// Add a default scope</span></div><div class="line"><a class="code" href="group__rdmnet__api__common.html#ga7244ab5c8edb8bc9c1e4792a6c64f798">rdmnet_client_scope_t</a> default_scope_handle;</div><div class="line"><a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/group__etcpal__error.html#ga743b0648f0ca798ef29c9f69c6e255af">etcpal_error_t</a> result = <a class="code" href="group__rdmnet__controller.html#ga95f857453eb6b8da8cadaa373420ab61">rdmnet_controller_add_default_scope</a>(my_controller_handle, &amp;default_scope_handle);</div><div class="line"></div><div class="line"><span class="comment">// Add a custom scope</span></div><div class="line"><a class="code" href="struct_rdmnet_scope_config.html">RdmnetScopeConfig</a> scope_config;</div><div class="line"><a class="code" href="group__rdmnet__api__common.html#ga0b906d1d6ed5fcc678e9c530e440b62f">RDMNET_CLIENT_SET_SCOPE</a>(&amp;scope_config, <span class="stringliteral">&quot;custom_scope_name&quot;</span>);</div><div class="line"></div><div class="line"><a class="code" href="group__rdmnet__api__common.html#ga7244ab5c8edb8bc9c1e4792a6c64f798">rdmnet_client_scope_t</a> custom_scope_handle;</div><div class="line"><a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/group__etcpal__error.html#ga743b0648f0ca798ef29c9f69c6e255af">etcpal_error_t</a> result = <a class="code" href="group__rdmnet__controller.html#ga4363e0f31f3f85f5526b55d2c034ed4e">rdmnet_controller_add_scope</a>(my_controller_handle, &amp;scope_config, &amp;custom_scope_handle);</div></div><!-- fragment --><p> 
</div>
<div id="div_4_cpp" class="tabcontent">
</p>
<div class="fragment"><div class="line"><a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/classetcpal_1_1_error.html">etcpal::Error</a> add_res = controller.<a class="code" href="classrdmnet_1_1_controller.html#a747d4c004d271d2b4eff5174489670e3">AddDefaultScope</a>();</div><div class="line"><span class="comment">// Or...</span></div><div class="line"><a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/classetcpal_1_1_error.html">etcpal::Error</a> add_res = controller.<a class="code" href="classrdmnet_1_1_controller.html#a752a7b8897f2ccae3b76c0e36946cf26">AddScope</a>(<span class="stringliteral">&quot;custom_scope_name&quot;</span>);</div><div class="line"></div><div class="line"><span class="keywordflow">if</span> (add_res)</div><div class="line">{</div><div class="line">  <a class="code" href="group__rdmnet__cpp__common.html#gadf5994aa4727265c21622c5a0f997ceb">rdmnet::ScopeHandle</a> default_scope_handle = *add_res;</div><div class="line">}</div><div class="line"><span class="keywordflow">else</span></div><div class="line">{</div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Error adding default scope: &#39;&quot;</span> &lt;&lt; add_res.result().<a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/classetcpal_1_1_error.html#a19c380b03cea21d7ac7325136a131ff0">ToString</a>() &lt;&lt; <span class="stringliteral">&quot;&#39;\n&quot;</span></div><div class="line">}</div></div><!-- fragment --><p> 
</div>
</p>
<h3>Dynamic vs Static Scopes</h3>
<p>Adding a scope will immediately begin the scope connection state machine from the RDMnet tick thread. If a static configuration is not provided (using the <a class="el" href="group__rdmnet__api__common.html#ga0b906d1d6ed5fcc678e9c530e440b62f" title="Initialize an RdmnetScopeConfig struct with a scope string. ">RDMNET_CLIENT_SET_SCOPE()</a> macro to initialize an <a class="el" href="struct_rdmnet_scope_config.html" title="A set of configuration information for a single scope in which an RDMnet client is participating...">RdmnetScopeConfig</a>, or calling <a class="el" href="classrdmnet_1_1_controller.html#a752a7b8897f2ccae3b76c0e36946cf26" title="Add a new scope to this controller instance. ">rdmnet::Controller::AddScope()</a> with only one argument) the first action will be to attempt to discover brokers for this scope using DNS-SD. Once a broker is found, connection will be initiated automatically, and the result will be delivered via either the connected or connect_failed callback.</p>
<p>If a broker for a given scope has been configured with a static IP address and port, you can skip DNS-SD discovery by providing a static configuration:</p>
<p> 
<div class="tab">
  <button id="button_5_c" class="tablinks" onclick="selectLanguage(event, '5', 'c')">C</button>
  <button id="button_5_cpp" class="tablinks" onclick="selectLanguage(event, '5', 'cpp')">C++</button>
</div>
<div id="div_5_c" class="tabcontent">
</p>
<div class="fragment"><div class="line"><span class="comment">// Get configured static broker address</span></div><div class="line"><a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/struct_etc_pal_sock_addr.html">EtcPalSockAddr</a> static_broker_addr;</div><div class="line"><a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/group__etcpal__inet.html#ga92ba01cb2c81a8a97b9555ecf0ab2fe5">etcpal_string_to_ip</a>(<a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/group__etcpal__inet.html#gga847282e3fd17bf75ec83292326c455eea73ea615eceba61f26d92a63f3738f635">kEtcPalIpTypeV4</a>, <span class="stringliteral">&quot;192.168.2.1&quot;</span>, &amp;static_broker_addr.<a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/struct_etc_pal_sock_addr.html#a19cc8016f534a565f984438cfe911a9e">ip</a>);</div><div class="line">static_broker_addr.<a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/struct_etc_pal_sock_addr.html#a8e0798404bf2cf5dabb84c5ba9a4f236">port</a> = 8000;</div><div class="line"></div><div class="line"><a class="code" href="struct_rdmnet_scope_config.html">RdmnetScopeConfig</a> config;</div><div class="line"><a class="code" href="group__rdmnet__api__common.html#ga500c0af02a2db3a6b835f26cf304da85">RDMNET_CLIENT_SET_STATIC_SCOPE</a>(&amp;config, <span class="stringliteral">&quot;my_custom_scope&quot;</span>, static_broker_addr);</div><div class="line"><span class="comment">// Or:</span></div><div class="line"><a class="code" href="group__rdmnet__api__common.html#gab2855ff14aba079140f1070f80140247">RDMNET_CLIENT_SET_STATIC_DEFAULT_SCOPE</a>(&amp;config, static_broker_addr);</div><div class="line"></div><div class="line"><a class="code" href="group__rdmnet__api__common.html#ga7244ab5c8edb8bc9c1e4792a6c64f798">rdmnet_client_scope_t</a> scope_handle;</div><div class="line"><a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/group__etcpal__error.html#ga743b0648f0ca798ef29c9f69c6e255af">etcpal_error_t</a> result = <a class="code" href="group__rdmnet__controller.html#ga4363e0f31f3f85f5526b55d2c034ed4e">rdmnet_controller_add_scope</a>(my_controller_handle, &amp;config, &amp;scope_handle);</div></div><!-- fragment --><p> 
</div>
<div id="div_5_cpp" class="tabcontent">
</p>
<div class="fragment"><div class="line"><span class="comment">// Get configured static broker address</span></div><div class="line">etcpal::Sockaddr static_broker_addr(<a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/classetcpal_1_1_ip_addr.html#a431892e2354d1b617e2dd0278b8a9f30">etcpal::IpAddr::FromString</a>(<span class="stringliteral">&quot;192.168.2.1&quot;</span>), 8000);</div><div class="line"><a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/classetcpal_1_1_error.html">etcpal::Error</a> add_res = controller.<a class="code" href="classrdmnet_1_1_controller.html#a752a7b8897f2ccae3b76c0e36946cf26">AddScope</a>(<span class="stringliteral">&quot;my_custom_scope&quot;</span>, static_broker_addr);</div><div class="line"><span class="comment">// Or:</span></div><div class="line"><a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/classetcpal_1_1_error.html">etcpal::Error</a> add_res = controller.<a class="code" href="classrdmnet_1_1_controller.html#a747d4c004d271d2b4eff5174489670e3">AddDefaultScope</a>(static_broker_addr);</div></div><!-- fragment --><p> 
</div>
</p>
<h2>Handling Callbacks</h2>
<p>The library will dispatch callback notifications from the background thread which is started when <a class="el" href="group__rdmnet__api__common.html#gac35e678c3cc099a73e9314614215e1d8" title="Initialize the RDMnet library. ">rdmnet_init()</a> is called. It is safe to call any RDMnet API function from any callback; in fact, this is the recommended way of handling many callbacks.</p>
<p>For example, a very common controller behavior will be to fetch a client list from the broker after a successful connection:</p>
<p> 
<div class="tab">
  <button id="button_6_c" class="tablinks" onclick="selectLanguage(event, '6', 'c')">C</button>
  <button id="button_6_cpp" class="tablinks" onclick="selectLanguage(event, '6', 'cpp')">C++</button>
</div>
<div id="div_6_c" class="tabcontent">
</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> controller_connected_callback(<a class="code" href="group__rdmnet__controller.html#gae857478c160127b99ef4c092ac608fcb">rdmnet_controller_t</a> controller_handle, <a class="code" href="group__rdmnet__api__common.html#ga7244ab5c8edb8bc9c1e4792a6c64f798">rdmnet_client_scope_t</a> scope_handle,</div><div class="line">                                   <span class="keyword">const</span> <a class="code" href="struct_rdmnet_client_connected_info.html">RdmnetClientConnectedInfo</a>* info, <span class="keywordtype">void</span>* context)</div><div class="line">{</div><div class="line">  <span class="keywordtype">char</span> addr_str[<a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/group__etcpal__inet.html#gacd7ec0d81e171166483c7629669bf05d">ETCPAL_IP_STRING_BYTES</a>];</div><div class="line">  <a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/group__etcpal__inet.html#gaf98da0ae21f7960b5e046c55b8d79c4a">etcpal_ip_to_string</a>(&amp;info-&gt;<a class="code" href="struct_rdmnet_client_connected_info.html#a39d671dfd8919b93fe23dba6dbfba905">broker_addr</a>.<a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/struct_etc_pal_sock_addr.html#a19cc8016f534a565f984438cfe911a9e">ip</a>, addr_str);</div><div class="line">  printf(<span class="stringliteral">&quot;Connected to broker &#39;%s&#39; at address %s:%d\n&quot;</span>, info-&gt;<a class="code" href="struct_rdmnet_client_connected_info.html#a09b4687edadab4b4334a33b38d00cf2f">broker_name</a>, addr_str, info-&gt;<a class="code" href="struct_rdmnet_client_connected_info.html#a39d671dfd8919b93fe23dba6dbfba905">broker_addr</a>.<a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/struct_etc_pal_sock_addr.html#a8e0798404bf2cf5dabb84c5ba9a4f236">port</a>);</div><div class="line"></div><div class="line">  <span class="comment">// Check handles and/or context as necessary...</span></div><div class="line"></div><div class="line">  <a class="code" href="group__rdmnet__controller.html#ga6d30907e6d09ada38a1be228d0f6809c">rdmnet_controller_request_client_list</a>(controller_handle, scope_handle);</div><div class="line">}                                   </div></div><!-- fragment --><p> 
</div>
<div id="div_6_cpp" class="tabcontent">
</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> MyControllerNotifyHandler::HandleConnectedToBroker(<a class="code" href="classrdmnet_1_1_controller.html#a585adefdd50c5a7bc63d3a5625889c7d">rdmnet::Controller::Handle</a> controller_handle,</div><div class="line">                                                        <a class="code" href="group__rdmnet__cpp__common.html#gadf5994aa4727265c21622c5a0f997ceb">rdmnet::ScopeHandle</a> scope_handle,</div><div class="line">                                                        <span class="keyword">const</span> <a class="code" href="classrdmnet_1_1_client_connected_info.html">rdmnet::ClientConnectedInfo</a>&amp; info)</div><div class="line">{</div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Connected to broker &#39;&quot;</span> &lt;&lt; info.<a class="code" href="classrdmnet_1_1_client_connected_info.html#a751d070cb4c1f89d838955298270b6cf">broker_name</a>()</div><div class="line">            &lt;&lt; <span class="stringliteral">&quot;&#39; at IP address &quot;</span> &lt;&lt; info.<a class="code" href="classrdmnet_1_1_client_connected_info.html#af30653fa66bd5b267c54cf81a8c7eb3d">broker_addr</a>().<a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/classetcpal_1_1_sock_addr.html#a19c380b03cea21d7ac7325136a131ff0">ToString</a>() &lt;&lt; <span class="charliteral">&#39;\n&#39;</span>;</div><div class="line"></div><div class="line">  <span class="comment">// Check handles as necessary and get controller instance...</span></div><div class="line">  controller.<a class="code" href="classrdmnet_1_1_controller.html#a31525848734a10e0762b9114a98dcc5b">RequestClientList</a>(scope_handle);</div><div class="line">}</div></div><!-- fragment --><p> 
</div>
</p>
<h3>Connection Failure</h3>
<p>It's worth noting connection failure as a special case here. RDMnet connections can fail for many reasons, including user misconfiguration, network misconfiguration, components starting up or shutting down, programming errors, and more.</p>
<p>The ClientConnectFailedInfo and ClientDisconnectedInfo structs passed back with the "connect failed" and "disconnected" callbacks respectively have comprehensive information about the failure, including enum values containing the library's categorization of the failure, protocol reason codes and socket errors where applicable. This information is typically used mostly for logging and debugging. Each of these codes has a respective <code>to_string()</code> function to aid in logging.</p>
<p>For programmatic use, the structs also contain a <code>will_retry</code> member which indicates whether the library plans to retry this connection in the background. The only circumstances under which the library will not retry is when a connection failure is determined to be either a programming error or a user misconfiguration. Some examples of these circumstances are:</p>
<ul>
<li>The broker explicitly rejected a connection with a reason code indicating a configuration error, such as <code>CONNECT_SCOPE_MISMATCH</code> or <code>CONNECT_DUPLICATE_UID</code>.</li>
<li>The library failed to create a network socket before the connection was initiated.</li>
</ul>
<h2>Discovering Devices</h2>
<p>To discover devices in RDMnet, you need to request a <em>Client List</em> from the broker you're connected to. In our API, this is very easy - as we saw in the callbacks section earlier, we can just call <a class="el" href="group__rdmnet__controller.html#ga6d30907e6d09ada38a1be228d0f6809c" title="Request a client list from a broker. ">rdmnet_controller_request_client_list()</a> or <a class="el" href="classrdmnet_1_1_controller.html#a31525848734a10e0762b9114a98dcc5b" title="Request a client list from a broker. ">rdmnet::Controller::RequestClientList()</a>. This sends the appropriate request to the broker, and the reply will come back in the "Client List Update" callback:</p>
<p> 
<div class="tab">
  <button id="button_7_c" class="tablinks" onclick="selectLanguage(event, '7', 'c')">C</button>
  <button id="button_7_cpp" class="tablinks" onclick="selectLanguage(event, '7', 'cpp')">C++</button>
</div>
<div id="div_7_c" class="tabcontent">
</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> my_client_list_update_cb(<a class="code" href="group__rdmnet__controller.html#gae857478c160127b99ef4c092ac608fcb">rdmnet_controller_t</a> controller_handle, <a class="code" href="group__rdmnet__api__common.html#ga7244ab5c8edb8bc9c1e4792a6c64f798">rdmnet_client_scope_t</a> scope_handle,</div><div class="line">                              <a class="code" href="group__rdmnet__api__common.html#ga47e9b8ab4e35d074085d3d9a91f77ac2">client_list_action_t</a> list_action, <span class="keyword">const</span> <a class="code" href="struct_rdmnet_rpt_client_list.html">RdmnetRptClientList</a>* list, <span class="keywordtype">void</span>* context)</div><div class="line">{</div><div class="line">  <span class="comment">// Check handles and/or context as necessary...</span></div><div class="line"></div><div class="line">  <span class="keywordflow">switch</span> (list_action)</div><div class="line">  {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group__rdmnet__api__common.html#gga47e9b8ab4e35d074085d3d9a91f77ac2a28f365664cab7adfffbad8c478ca3a09">kRdmnetClientListAppend</a>:</div><div class="line">      <span class="comment">// These are new entries to be added to the list of clients. Append the new entry to our</span></div><div class="line">      <span class="comment">// bookkeeping.</span></div><div class="line">      add_new_clients(list-&gt;<a class="code" href="struct_rdmnet_rpt_client_list.html#ab83c415e9196e74a3fa20b73d3407586">client_entries</a>, list-&gt;<a class="code" href="struct_rdmnet_rpt_client_list.html#acdd2b6b109461335c356422b1bb15d6c">num_client_entries</a>);</div><div class="line">      <span class="keywordflow">break</span>;</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group__rdmnet__api__common.html#gga47e9b8ab4e35d074085d3d9a91f77ac2a62a9556be67db06e0fd26dbd5a20ff45">kRdmnetClientListRemove</a>:</div><div class="line">      <span class="comment">// These are entries to be removed from the list of clients. Remove the entry from our</span></div><div class="line">      <span class="comment">// bookkeeping.</span></div><div class="line">      remove_clients(list-&gt;<a class="code" href="struct_rdmnet_rpt_client_list.html#ab83c415e9196e74a3fa20b73d3407586">client_entries</a>, list-&gt;<a class="code" href="struct_rdmnet_rpt_client_list.html#acdd2b6b109461335c356422b1bb15d6c">num_client_entries</a>);</div><div class="line">      <span class="keywordflow">break</span>;</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group__rdmnet__api__common.html#gga47e9b8ab4e35d074085d3d9a91f77ac2a8401f8f58863ec76c40f9f1fd84d3440">kRdmnetClientListUpdate</a>:</div><div class="line">      <span class="comment">// These are entries to be updated in the list of clients. Update the corresponding entry</span></div><div class="line">      <span class="comment">// in our bookkeeping.</span></div><div class="line">      update_clients(list-&gt;<a class="code" href="struct_rdmnet_rpt_client_list.html#ab83c415e9196e74a3fa20b73d3407586">client_entries</a>, list-&gt;<a class="code" href="struct_rdmnet_rpt_client_list.html#acdd2b6b109461335c356422b1bb15d6c">num_client_entries</a>);</div><div class="line">      <span class="keywordflow">break</span>;</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group__rdmnet__api__common.html#gga47e9b8ab4e35d074085d3d9a91f77ac2a93835bbdfa444ea89287ecb5416b1704">kRdmnetClientListReplace</a>:</div><div class="line">      <span class="comment">// This is the full client list currently connected to the broker - our existing client </span></div><div class="line">      <span class="comment">// list should be replaced wholesale with this one. This will be the response to</span></div><div class="line">      <span class="comment">// rdmnet_controller_request_client_list(); the other cases are sent unsolicited.</span></div><div class="line">      replace_client_list(list-&gt;<a class="code" href="struct_rdmnet_rpt_client_list.html#ab83c415e9196e74a3fa20b73d3407586">client_entries</a>, list-&gt;<a class="code" href="struct_rdmnet_rpt_client_list.html#acdd2b6b109461335c356422b1bb15d6c">num_client_entries</a>);</div><div class="line">      <span class="keywordflow">break</span>;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (list-&gt;<a class="code" href="struct_rdmnet_rpt_client_list.html#ae47a845eafcc1ead4a2c5e39c9e7ae50">more_coming</a>)</div><div class="line">  {</div><div class="line">    <span class="comment">// The library ran out of memory pool space while allocating client entries - after this</span></div><div class="line">    <span class="comment">// callback returns, another will be delivered with the continuation of this response.</span></div><div class="line">    <span class="comment">// If RDMNET_DYNAMIC_MEM == 1 (the default on non-embedded platforms), this flag will never be</span></div><div class="line">    <span class="comment">// set to true and does not need to be checked.</span></div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p> 
</div>
<div id="div_7_cpp" class="tabcontent">
</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> MyControllerNotifyHandler::HandleClientListUpdate(<a class="code" href="classrdmnet_1_1_controller.html#a585adefdd50c5a7bc63d3a5625889c7d">rdmnet::Controller::Handle</a> controller_handle,</div><div class="line">                                                       <a class="code" href="group__rdmnet__cpp__common.html#gadf5994aa4727265c21622c5a0f997ceb">rdmnet::ScopeHandle</a> scope_handle,</div><div class="line">                                                       <a class="code" href="group__rdmnet__api__common.html#ga47e9b8ab4e35d074085d3d9a91f77ac2">client_list_action_t</a> list_action,</div><div class="line">                                                       <span class="keyword">const</span> <a class="code" href="classrdmnet_1_1_rpt_client_list.html">rdmnet::RptClientList</a>&amp; list)</div><div class="line">{</div><div class="line">  <span class="comment">// Check handles as necessary...</span></div><div class="line"></div><div class="line">  <span class="keywordflow">switch</span> (list_action)</div><div class="line">  {</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group__rdmnet__api__common.html#gga47e9b8ab4e35d074085d3d9a91f77ac2a28f365664cab7adfffbad8c478ca3a09">kRdmnetClientListAppend</a>:</div><div class="line">      <span class="comment">// These are new entries to be added to the list of clients. Append the new entry to our</span></div><div class="line">      <span class="comment">// bookkeeping.</span></div><div class="line">      AddNewClients(list.<a class="code" href="classrdmnet_1_1_rpt_client_list.html#a0899bb62646ac3b9220986a144219917">GetClientEntries</a>());</div><div class="line">      <span class="keywordflow">break</span>;</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group__rdmnet__api__common.html#gga47e9b8ab4e35d074085d3d9a91f77ac2a62a9556be67db06e0fd26dbd5a20ff45">kRdmnetClientListRemove</a>:</div><div class="line">      <span class="comment">// These are entries to be removed from the list of clients. Remove the entry from our</span></div><div class="line">      <span class="comment">// bookkeeping.</span></div><div class="line">      RemoveClients(list.<a class="code" href="classrdmnet_1_1_rpt_client_list.html#a0899bb62646ac3b9220986a144219917">GetClientEntries</a>());</div><div class="line">      <span class="keywordflow">break</span>;</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group__rdmnet__api__common.html#gga47e9b8ab4e35d074085d3d9a91f77ac2a8401f8f58863ec76c40f9f1fd84d3440">kRdmnetClientListUpdate</a>:</div><div class="line">      <span class="comment">// These are entries to be updated in the list of clients. Update the corresponding entry</span></div><div class="line">      <span class="comment">// in our bookkeeping.</span></div><div class="line">      UpdateClients(list.<a class="code" href="classrdmnet_1_1_rpt_client_list.html#a0899bb62646ac3b9220986a144219917">GetClientEntries</a>());</div><div class="line">      <span class="keywordflow">break</span>;</div><div class="line">    <span class="keywordflow">case</span> <a class="code" href="group__rdmnet__api__common.html#gga47e9b8ab4e35d074085d3d9a91f77ac2a93835bbdfa444ea89287ecb5416b1704">kRdmnetClientListReplace</a>:</div><div class="line">      <span class="comment">// This is the full client list currently connected to the broker - our existing client </span></div><div class="line">      <span class="comment">// list should be replaced wholesale with this one. This will be the response to</span></div><div class="line">      <span class="comment">// Controller::RequestClientList(); the other cases are sent unsolicited.</span></div><div class="line">      ReplaceClientList(list.<a class="code" href="classrdmnet_1_1_rpt_client_list.html#a0899bb62646ac3b9220986a144219917">GetClientEntries</a>());</div><div class="line">      <span class="keywordflow">break</span>;</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (list.<a class="code" href="classrdmnet_1_1_rpt_client_list.html#aab88e3093b96c76a3e9fbe99a67968e7">more_coming</a>())</div><div class="line">  {</div><div class="line">    <span class="comment">// The library ran out of memory pool space while allocating client entries - after this</span></div><div class="line">    <span class="comment">// callback returns, another will be delivered with the continuation of this response.</span></div><div class="line">    <span class="comment">// If RDMNET_DYNAMIC_MEM == 1 (the default on non-embedded platforms), this flag will never be</span></div><div class="line">    <span class="comment">// set to true and does not need to be checked.</span></div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p> 
</div>
</p>
<p>Brokers also send Client List Update messages asynchronously when things change; these messages contain only the differences from the last client list sent to a given controller. This means you should only have to request a full client list when a new connection completes; after that, expect periodic callbacks notifying you of changes, with the <a class="el" href="group__rdmnet__api__common.html#ga47e9b8ab4e35d074085d3d9a91f77ac2" title="How to apply the client entries to the existing client list in a client_list_update_received callback...">client_list_action_t</a> set appropriately as shown above.</p>
<p>Clients include both devices and other controllers; to differentiate the two, check the type field in each RPT client entry structure.</p>
<h2>Sending RDM Commands</h2>
<p>Sending RDM commands requires a destination address structure to indicate the RDMnet component and RDM responder to which the command is addressed. See <a class="el" href="devices_and_gateways.html">Devices and Gateways</a> for more information on the fields of the destination address structure.</p>
<p>After sending a command, the library will provide a <em>sequence number</em> that will be echoed in the corresponding RDM response. This sequence number should be saved.</p>
<p> 
<div class="tab">
  <button id="button_8_c" class="tablinks" onclick="selectLanguage(event, '8', 'c')">C</button>
  <button id="button_8_cpp" class="tablinks" onclick="selectLanguage(event, '8', 'cpp')">C++</button>
</div>
<div id="div_8_c" class="tabcontent">
</p>
<div class="fragment"><div class="line"><a class="code" href="struct_rdmnet_destination_addr.html">RdmnetDestinationAddr</a> dest = <a class="code" href="group__rdmnet__api__common.html#ga58f3b5c690b7ebd792e8d2851af95ea0">RDMNET_ADDR_TO_DEFAULT_RESPONDER</a>(0x6574, 0x12345678);</div><div class="line">uint32_t cmd_seq_num;</div><div class="line"><a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/group__etcpal__error.html#ga743b0648f0ca798ef29c9f69c6e255af">etcpal_error_t</a> result = <a class="code" href="group__rdmnet__controller.html#ga872fb3896fb620b339635bd40830e03f">rdmnet_controller_send_get_command</a>(my_controller_handle, my_scope_handle, &amp;dest,</div><div class="line">                                                           E120_DEVICE_LABEL, NULL, 0, &amp;cmd_seq_num);</div><div class="line"><span class="keywordflow">if</span> (result == <a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/group__etcpal__error.html#gga743b0648f0ca798ef29c9f69c6e255afae403d046b4ba4e81dce121266c2cca8d">kEtcPalErrOk</a>)</div><div class="line">{</div><div class="line">  <span class="comment">// cmd_seq_num identifies this command transaction. Store it for when a response is received.</span></div><div class="line">}</div></div><!-- fragment --><p> 
</div>
<div id="div_8_cpp" class="tabcontent">
</p>
<div class="fragment"><div class="line"><span class="keyword">auto</span> dest_addr = <a class="code" href="classrdmnet_1_1_destination_addr.html#a8c1f337f355371cdb56f19f164cf125b">rdmnet::DestinationAddr::ToDefaultResponder</a>(0x6574, 0x12345678);</div><div class="line"><a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/classetcpal_1_1_expected.html">etcpal::Expected&lt;uint32_t&gt;</a> result = controller.<a class="code" href="classrdmnet_1_1_controller.html#a1cbb710605f06cddd4e043ce71653390">SendGetCommand</a>(my_scope_handle, dest_addr, E120_DEVICE_LABEL);</div><div class="line"></div><div class="line"><span class="keywordflow">if</span> (result)</div><div class="line">{</div><div class="line">  <span class="comment">// *result identifies this command transaction. Store it for when a response is received.</span></div><div class="line">}</div></div><!-- fragment --><p> 
</div>
</p>
<h2>Handling RDM Responses</h2>
<p>Responses to commands you send will be delivered asynchronously through the "RDM response" callback. You may also receive "unsolicited responses" - asynchronous state updates from devices that don't correspond to changes you requested.</p>
<p>Responses are always delivered atomically in RDMnet (contrast this with RDM, which uses the ACK_OVERFLOW mechanism to deliver responses with oversized data). This means that RDM response data in RDMnet can be larger than the 231-byte limit that is customary in RDM. The only time a response can be fragmented is if the RDMnet library was compiled with dynamic memory allocation disabled (see the note on the more_coming flag below for more information on this).</p>
<p> 
<div class="tab">
  <button id="button_9_c" class="tablinks" onclick="selectLanguage(event, '9', 'c')">C</button>
  <button id="button_9_cpp" class="tablinks" onclick="selectLanguage(event, '9', 'cpp')">C++</button>
</div>
<div id="div_9_c" class="tabcontent">
</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> rdm_response_callback(<a class="code" href="group__rdmnet__controller.html#gae857478c160127b99ef4c092ac608fcb">rdmnet_controller_t</a> controller_handle, <a class="code" href="group__rdmnet__api__common.html#ga7244ab5c8edb8bc9c1e4792a6c64f798">rdmnet_client_scope_t</a> scope_handle,</div><div class="line">                           <span class="keyword">const</span> <a class="code" href="struct_rdmnet_rdm_response.html">RdmnetRdmResponse</a>* resp, <span class="keywordtype">void</span>* context)</div><div class="line">{</div><div class="line">  <span class="comment">// Check handles and/or context as necessary...</span></div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (resp-&gt;<a class="code" href="struct_rdmnet_rdm_response.html#a6927eaec013a0e5d6ec7230f46618308">is_response_to_me</a>)</div><div class="line">  {</div><div class="line">    <span class="comment">// Verify resp-&gt;seq_num against the cmd_seq_num you stored earlier. This command transaction is</span></div><div class="line">    <span class="comment">// now finished.</span></div><div class="line">  }</div><div class="line">  <span class="keywordflow">else</span></div><div class="line">  {</div><div class="line">    <span class="comment">// This is either an unsolicited RDM response (an asynchronous update about a change you didn&#39;t initiate)</span></div><div class="line">    <span class="comment">// or a response to a command by another controller. Use it to update your cached data about this</span></div><div class="line">    <span class="comment">// RDMnet responder.</span></div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">// If RDMNET_RESP_ORIGINAL_COMMAND_INCLUDED(resp) == true, resp-&gt;cmd will contain the original command you sent. </span></div><div class="line"></div><div class="line">  handle_response_data(resp-&gt;<a class="code" href="struct_rdmnet_rdm_response.html#a7166b29ccdcf9789259f036c6f9c1c96">rdm_header</a>.<a class="codeRef" doxygen="/home/vsts/work/1/s/external/RDM/docs/RDM.tag:https://etclabs.github.io/RDM/docs/head/" href="https://etclabs.github.io/RDM/docs/head/struct_rdm_response_header.html#a43f5e73445b99b42061429682fdc78fc">param_id</a>, resp-&gt;<a class="code" href="struct_rdmnet_rdm_response.html#a757c3836c4ba3194c16a7fdee725478b">rdm_data</a>, resp-&gt;<a class="code" href="struct_rdmnet_rdm_response.html#a40a585bd57aa4b45b518408829a9038f">rdm_data_len</a>);</div><div class="line"></div><div class="line">  <span class="comment">// RdmnetRdmResponse structures do not own their data and the data will be invalid when this callback</span></div><div class="line">  <span class="comment">// returns. To save the data for later processing:</span></div><div class="line">  <a class="code" href="struct_rdmnet_saved_rdm_response.html">RdmnetSavedRdmResponse</a> saved_resp;</div><div class="line">  <a class="code" href="group__rdmnet__api__common.html#gad5d372571287234f8d82988755a1e967">rdmnet_save_rdm_response</a>(resp, &amp;saved_resp);</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (resp-&gt;<a class="code" href="struct_rdmnet_rdm_response.html#a7b23c9c9b5ee45b4be800413eb01a6f8">more_coming</a>)</div><div class="line">  {</div><div class="line">    <span class="comment">// The library ran out of memory pool space while allocating responses - after this callback</span></div><div class="line">    <span class="comment">// returns, another will be delivered with the continuation of this response data.</span></div><div class="line">    <span class="comment">// If RDMNET_DYNAMIC_MEM == 1 (the default on non-embedded platforms), this flag will never be</span></div><div class="line">    <span class="comment">// set to true.</span></div><div class="line"></div><div class="line">    <span class="comment">// When more responses come, you can append their data to your saved response:</span></div><div class="line">    <a class="code" href="group__rdmnet__api__common.html#ga480d58441aecb63a71b68b2fce5ba8b5">rdmnet_append_to_saved_rdm_response</a>(resp, &amp;previously_saved_resp);</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p> 
</div>
<div id="div_9_cpp" class="tabcontent">
</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> MyControllerNotifyHandler::HandleRdmResponse(<a class="code" href="classrdmnet_1_1_controller.html#a585adefdd50c5a7bc63d3a5625889c7d">rdmnet::Controller::Handle</a> controller_handle,</div><div class="line">                                                  <a class="code" href="group__rdmnet__cpp__common.html#gadf5994aa4727265c21622c5a0f997ceb">rdmnet::ScopeHandle</a> scope_handle,</div><div class="line">                                                  <span class="keyword">const</span> <a class="code" href="classrdmnet_1_1_rdm_response.html">rdmnet::RdmResponse</a>&amp; resp)</div><div class="line">{</div><div class="line">  <span class="comment">// Check handles as necessary...</span></div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (resp.is_response_to_me())</div><div class="line">  {</div><div class="line">    <span class="comment">// Verify resp.seq_num() against the command seq_num you stored earlier. This command transaction is</span></div><div class="line">    <span class="comment">// now finished.</span></div><div class="line">  }</div><div class="line">  <span class="keywordflow">else</span></div><div class="line">  {</div><div class="line">    <span class="comment">// This is either an unsolicited RDM response (an asynchronous update about a change you didn&#39;t initiate)</span></div><div class="line">    <span class="comment">// or a response to a command by another controller. Use it to update your cached data about this</span></div><div class="line">    <span class="comment">// RDMnet responder.</span></div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">// If resp.OriginalCommandIncluded() == true, the original_cmd_...() getters will contain the data</span></div><div class="line">  <span class="comment">// of the original command that instigated this response.</span></div><div class="line"></div><div class="line">  HandleResponseData(resp.<a class="code" href="classrdmnet_1_1_rdm_response.html#af9e3f18e08eff4dca2fc18f035903695">param_id</a>(), resp.<a class="code" href="classrdmnet_1_1_rdm_response.html#a223becaa3360fc6cb5d1fa84a86a32ad">data</a>(), resp.<a class="code" href="classrdmnet_1_1_rdm_response.html#af8f2d231fa209babefdaec4a5748a788">data_len</a>());</div><div class="line"></div><div class="line">  <span class="comment">// RdmResponse classes do not own their data and the data will be invalid when this callback returns.</span></div><div class="line">  <span class="comment">// To save the data for later processing:</span></div><div class="line">  <a class="code" href="classrdmnet_1_1_saved_rdm_response.html">rdmnet::SavedRdmResponse</a> saved_resp = resp.<a class="code" href="classrdmnet_1_1_rdm_response.html#a910a0f0e0e0127452911439cde553974">Save</a>();</div><div class="line"></div><div class="line">  <span class="keywordflow">if</span> (resp.<a class="code" href="classrdmnet_1_1_rdm_response.html#a56483ae1ffd2ee5127b3f4555b941a83">more_coming</a>())</div><div class="line">  {</div><div class="line">    <span class="comment">// The library ran out of memory pool space while allocating responses - after this callback</span></div><div class="line">    <span class="comment">// returns, another will be delivered with the continuation of this response.</span></div><div class="line">    <span class="comment">// If RDMNET_DYNAMIC_MEM == 1 (the default on non-embedded platforms), this flag will never be set to true.</span></div><div class="line"></div><div class="line">    <span class="comment">// When more responses come, you can append their data to your saved response:</span></div><div class="line">    previously_saved_resp.<a class="code" href="classrdmnet_1_1_saved_rdm_response.html#a7b17bc392be713e83bdb34d7926e3568">AppendData</a>(resp);</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p> 
</div>
</p>
<h2>Handling RPT Status Messages</h2>
<p>If something went wrong while either a broker or device was processing your message, you will get a response called an "RPT Status". There is a separate callback for handling these messages.</p>
<p>When you send an RDM command, you start a transaction that is identified by a 32-bit sequence number. That transaction is considered completed when you get either an RDM Response or an RPT Status containing that same sequence number.</p>
<p> 
<div class="tab">
  <button id="button_10_c" class="tablinks" onclick="selectLanguage(event, '10', 'c')">C</button>
  <button id="button_10_cpp" class="tablinks" onclick="selectLanguage(event, '10', 'cpp')">C++</button>
</div>
<div id="div_10_c" class="tabcontent">
</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> rpt_status_callback(<a class="code" href="group__rdmnet__controller.html#gae857478c160127b99ef4c092ac608fcb">rdmnet_controller_t</a> controller_handle, <a class="code" href="group__rdmnet__api__common.html#ga7244ab5c8edb8bc9c1e4792a6c64f798">rdmnet_client_scope_t</a> scope_handle,</div><div class="line">                         <span class="keyword">const</span> <a class="code" href="struct_rdmnet_rpt_status.html">RdmnetRptStatus</a>* status, <span class="keywordtype">void</span>* context)</div><div class="line">{</div><div class="line">  <span class="comment">// Check handles and/or context as necessary...</span></div><div class="line"></div><div class="line">  <span class="comment">// Verify status-&gt;seq_num against the cmd_seq_num you stored earlier.</span></div><div class="line"></div><div class="line">  <span class="keywordtype">char</span> uid_str[<a class="codeRef" doxygen="/home/vsts/work/1/s/external/RDM/docs/RDM.tag:https://etclabs.github.io/RDM/docs/head/" href="https://etclabs.github.io/RDM/docs/head/group__uid.html#gaca68c70b4aca047a5b8ff73e9d73b492">RDM_UID_STRING_BYTES</a>];</div><div class="line">  <a class="codeRef" doxygen="/home/vsts/work/1/s/external/RDM/docs/RDM.tag:https://etclabs.github.io/RDM/docs/head/" href="https://etclabs.github.io/RDM/docs/head/group__uid.html#ga90190789ec0a4c7262c47e2d7a1fdf43">rdm_uid_to_string</a>(&amp;status-&gt;<a class="code" href="struct_rdmnet_rpt_status.html#a341877f2348eb080feef58049da4d5d4">source_uid</a>, uid_str);</div><div class="line">  printf(<span class="stringliteral">&quot;Error sending RDM command to device %s: &#39;%s&#39;\n&quot;</span>, uid_str,</div><div class="line">         <a class="code" href="group__rdmnet__api__common.html#ga1b678629569257697ec6a7e855c71623">rdmnet_rpt_status_code_to_string</a>(status-&gt;<a class="code" href="struct_rdmnet_rpt_status.html#a7ee615642619dc3f5fd4f52fdf5205e7">status_code</a>));</div><div class="line"></div><div class="line">  <span class="comment">// Other logic as needed; remove our internal storage of the RDM transaction, etc.</span></div><div class="line">}</div></div><!-- fragment --><p> 
</div>
<div id="div_10_cpp" class="tabcontent">
</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> MyControllerNotifyHandler::HandleRptStatus(<a class="code" href="classrdmnet_1_1_controller.html#a585adefdd50c5a7bc63d3a5625889c7d">rdmnet::Controller::Handle</a> controller_handle,</div><div class="line">                                                <a class="code" href="group__rdmnet__cpp__common.html#gadf5994aa4727265c21622c5a0f997ceb">rdmnet::ScopeHandle</a> scope_handle,</div><div class="line">                                                <span class="keyword">const</span> <a class="code" href="classrdmnet_1_1_rpt_status.html">rdmnet::RptStatus</a>&amp; status)</div><div class="line">{</div><div class="line">  <span class="comment">// Check handles as necessary...</span></div><div class="line"></div><div class="line">  <span class="comment">// Verify status.seq_num() against the result of rdmnet::Controller::SendRdmCommand() you stored earlier.</span></div><div class="line"></div><div class="line">  std::cout &lt;&lt; <span class="stringliteral">&quot;Error sending RDM command to device &quot;</span> &lt;&lt; status.<a class="code" href="classrdmnet_1_1_rpt_status.html#a6507230a0c2c36aa6a55cfb75ab302ed">source_uid</a>().<a class="codeRef" doxygen="/home/vsts/work/1/s/external/RDM/docs/RDM.tag:https://etclabs.github.io/RDM/docs/head/" href="https://etclabs.github.io/RDM/docs/head/classrdm_1_1_uid.html#a19c380b03cea21d7ac7325136a131ff0">ToString</a>() &lt;&lt; <span class="stringliteral">&quot;: &#39;&quot;</span></div><div class="line">            &lt;&lt; status.<a class="code" href="classrdmnet_1_1_rpt_status.html#abc4ab4b133733568b9488dd986e8751a">CodeToString</a>() &lt;&lt; <span class="stringliteral">&quot;&#39;\n&quot;</span>;</div><div class="line"></div><div class="line">  <span class="comment">// Other logic as needed; remove our internal storage of the RDM transaction, etc.</span></div><div class="line">}</div></div><!-- fragment --><p> 
</div>
</p>
<h2>Getting Responder IDs</h2>
<p>Controllers may encounter RDMnet responders which have dynamic UIDs. Base RDMnet components such as controllers and devices can have dynamic UIDs, as can virtual responders present on devices. See <a class="el" href="devices_and_gateways.html">Devices and Gateways</a> for more information on virtual responders, and <a class="el" href="roles_and_addressing.html">Roles and Addressing</a> for more information on dynamic UIDs. As a reminder, a dynamic UID is identified by the top bit of the Manufacturer ID portion being set and the UID not being a broadcast UID; this can be tested using the convenience methods in the RDM library: <a class="elRef" doxygen="/home/vsts/work/1/s/external/RDM/docs/RDM.tag:https://etclabs.github.io/RDM/docs/head/" href="https://etclabs.github.io/RDM/docs/head/group__uid.html#ga6513e844d7b58f9cdee40244fe5a682f">RDMNET_UID_IS_DYNAMIC()</a> and/or <a class="elRef" doxygen="/home/vsts/work/1/s/external/RDM/docs/RDM.tag:https://etclabs.github.io/RDM/docs/head/" href="https://etclabs.github.io/RDM/docs/head/classrdm_1_1_uid.html#ab1affd5b2613fc51ad89a38272bff137">rdm::Uid::IsDynamic()</a>.</p>
<p>A responder using a dynamic UID may get a different UID at any time. For this reason, it is useful for a controller to be able to get a more permanent identifier for an RDMnet responder.</p>
<p>For controllers, devices and brokers, the permanent identifier is the CID, which is present alongside the UID in an RPT client list entry. If you want to track these components beyond a single RDMnet session, be sure to store the CID.</p>
<p>Virtual responders present on a device have a similar identifier called a Responder ID (RID) which has the same function as a CID for that virtual responder. The UIDs of a device's virtual responders are obtained using the <code>ENDPOINT_RESPONDERS</code> RDM command; however, this command's data does not include the RID. To obtain RIDs for a set of virtual responders, it is necessary to query the connected broker.</p>
<p> 
<div class="tab">
  <button id="button_11_c" class="tablinks" onclick="selectLanguage(event, '11', 'c')">C</button>
  <button id="button_11_cpp" class="tablinks" onclick="selectLanguage(event, '11', 'cpp')">C++</button>
</div>
<div id="div_11_c" class="tabcontent">
</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> handle_response_data(uint16_t param_id, <span class="keyword">const</span> uint8_t* param_data, <span class="keywordtype">size_t</span> param_data_len)</div><div class="line">{</div><div class="line">  <span class="comment">// This code is simplified and meant to illustrate an example of discovering virtual responders</span></div><div class="line">  <span class="comment">// using the ENDPOINT_RESPONDERS command.</span></div><div class="line">  <span class="keywordflow">if</span> (param_id == E137_7_ENDPOINT_RESPONDERS)</div><div class="line">  {</div><div class="line">    <span class="keywordtype">size_t</span> num_uids = ((param_data_len - 6) / 6); <span class="comment">// 6 bytes per UID, subtract the other data field sizes</span></div><div class="line">    <a class="codeRef" doxygen="/home/vsts/work/1/s/external/RDM/docs/RDM.tag:https://etclabs.github.io/RDM/docs/head/" href="https://etclabs.github.io/RDM/docs/head/struct_rdm_uid.html">RdmUid</a>* responder_uids = (<a class="codeRef" doxygen="/home/vsts/work/1/s/external/RDM/docs/RDM.tag:https://etclabs.github.io/RDM/docs/head/" href="https://etclabs.github.io/RDM/docs/head/struct_rdm_uid.html">RdmUid</a>*)calloc(num_uids, <span class="keyword">sizeof</span>(<a class="codeRef" doxygen="/home/vsts/work/1/s/external/RDM/docs/RDM.tag:https://etclabs.github.io/RDM/docs/head/" href="https://etclabs.github.io/RDM/docs/head/struct_rdm_uid.html">RdmUid</a>));</div><div class="line"></div><div class="line">    <span class="comment">// Unpack the response data into the responder_uids array...</span></div><div class="line"></div><div class="line">    <span class="comment">// Now request the RIDs from the broker for the responder UIDs.</span></div><div class="line">    <a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/group__etcpal__error.html#ga743b0648f0ca798ef29c9f69c6e255af">etcpal_error_t</a> result = <a class="code" href="group__rdmnet__controller.html#ga94cd30fd8391da362ba2331d24ffadae">rdmnet_controller_request_responder_ids</a>(my_controller_handle, my_scope_handle,</div><div class="line">                                                                    responder_uids, num_uids);</div><div class="line">    <span class="keywordflow">if</span> (result == <a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/group__etcpal__error.html#gga743b0648f0ca798ef29c9f69c6e255afae403d046b4ba4e81dce121266c2cca8d">kEtcPalErrOk</a>)</div><div class="line">    {</div><div class="line">      <span class="comment">// The broker&#39;s response will be forwarded to the RdmnetControllerResponderIdsReceivedCallback,</span></div><div class="line">      <span class="comment">// defined in the next snippet.</span></div><div class="line">    }</div><div class="line"></div><div class="line">    free(responder_uids);</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p> 
</div>
<div id="div_11_cpp" class="tabcontent">
</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> MyControllerNotifyHandler::HandleResponseData(uint16_t param_id, <span class="keyword">const</span> uint8_t* param_data, <span class="keywordtype">size_t</span> param_data_len)</div><div class="line">{</div><div class="line">  <span class="comment">// This code is simplified and meant to illustrate an example of discovering virtual responders</span></div><div class="line">  <span class="comment">// using the ENDPOINT_RESPONDERS command.</span></div><div class="line">  <span class="keywordflow">if</span> (param_id == E137_7_ENDPOINT_RESPONDERS)</div><div class="line">  {</div><div class="line">    std::vector&lt;RdmUid&gt; responder_uids;</div><div class="line"></div><div class="line">    <span class="comment">// Unpack the response data into the responder_uids array...</span></div><div class="line"></div><div class="line">    <span class="comment">// Now request the RIDs from the broker for the responder UIDs.</span></div><div class="line">    <a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/classetcpal_1_1_error.html">etcpal::Error</a> result = controller.<a class="code" href="classrdmnet_1_1_controller.html#ab9f5541545bf3a35120513286c33d71e">RequestResponderIds</a>(responder_uids);</div><div class="line">    <span class="keywordflow">if</span> (result)</div><div class="line">    {</div><div class="line">      <span class="comment">// The broker&#39;s response will be forwarded to the MyControllerNotifyHandler::HandleResponderIdsReceived()</span></div><div class="line">      <span class="comment">// callback, defined in the next snippet.</span></div><div class="line">    }</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p> 
</div>
</p>
<p>The broker will respond with a list of mappings between dynamic UIDs and RIDs known as a Dynamic UID Assignment List. Each entry in the list will contain a status code indicating whether the RID was looked up successfully, followed by the UID and RID.</p>
<p> 
<div class="tab">
  <button id="button_12_c" class="tablinks" onclick="selectLanguage(event, '12', 'c')">C</button>
  <button id="button_12_cpp" class="tablinks" onclick="selectLanguage(event, '12', 'cpp')">C++</button>
</div>
<div id="div_12_c" class="tabcontent">
</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> handle_responder_ids_received(<a class="code" href="group__rdmnet__controller.html#gae857478c160127b99ef4c092ac608fcb">rdmnet_controller_t</a> controller_handle, <a class="code" href="group__rdmnet__api__common.html#ga7244ab5c8edb8bc9c1e4792a6c64f798">rdmnet_client_scope_t</a> scope_handle,</div><div class="line">                                   <span class="keyword">const</span> <a class="code" href="struct_rdmnet_dynamic_uid_assignment_list.html">RdmnetDynamicUidAssignmentList</a>* list, <span class="keywordtype">void</span>* context)</div><div class="line">{</div><div class="line">  <span class="comment">// Check handles and/or context as necessary...</span></div><div class="line"></div><div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="struct_rdmnet_dynamic_uid_mapping.html">RdmnetDynamicUidMapping</a>* mapping = list-&gt;<a class="code" href="struct_rdmnet_dynamic_uid_assignment_list.html#af8d7a5c73e14c6d2f6aa2619619c6ddb">mappings</a>; mapping &lt; list-&gt;mappings + list-&gt;<a class="code" href="struct_rdmnet_dynamic_uid_assignment_list.html#a3725222dfe8114e80a413479ad6e8f1a">num_mappings</a>;</div><div class="line">       ++mapping)</div><div class="line">  {</div><div class="line">    <span class="keywordflow">if</span> (mapping-&gt;status_code == <a class="code" href="group__rdmnet__api__common.html#ggafc5c9ee7dffbca259051716bacea9620a1b3e6c28f0859c283862abf73923b388">kRdmnetDynamicUidStatusOk</a>)</div><div class="line">    {</div><div class="line">      <span class="comment">// This function is assumed to add the RID to the responder&#39;s cached data.</span></div><div class="line">      add_responder_rid(&amp;mapping-&gt;uid, &amp;mapping-&gt;rid);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">      <span class="keywordtype">char</span> uid_str[<a class="codeRef" doxygen="/home/vsts/work/1/s/external/RDM/docs/RDM.tag:https://etclabs.github.io/RDM/docs/head/" href="https://etclabs.github.io/RDM/docs/head/group__uid.html#gaca68c70b4aca047a5b8ff73e9d73b492">RDM_UID_STRING_BYTES</a>];</div><div class="line">      <a class="codeRef" doxygen="/home/vsts/work/1/s/external/RDM/docs/RDM.tag:https://etclabs.github.io/RDM/docs/head/" href="https://etclabs.github.io/RDM/docs/head/group__uid.html#ga90190789ec0a4c7262c47e2d7a1fdf43">rdm_uid_to_string</a>(&amp;mapping-&gt;uid, uid_str);</div><div class="line">      printf(<span class="stringliteral">&quot;Error obtaining RID for responder %s: &#39;%s&#39;\n&quot;</span>, uid_str,</div><div class="line">             <a class="code" href="group__rdmnet__api__common.html#ga362e057a96421081d8551d65bf403b6a">rdmnet_dynamic_uid_status_to_string</a>(mapping-&gt;status_code));</div><div class="line">    }</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p> 
</div>
<div id="div_12_cpp" class="tabcontent">
</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> MyControllerNotifyHandler::HandleResponderIdsReceived(<a class="code" href="classrdmnet_1_1_controller.html#a585adefdd50c5a7bc63d3a5625889c7d">rdmnet::Controller::Handle</a> controller_handle,</div><div class="line">                                                           <a class="code" href="group__rdmnet__cpp__common.html#gadf5994aa4727265c21622c5a0f997ceb">rdmnet::ScopeHandle</a> scope_handle,</div><div class="line">                                                           <span class="keyword">const</span> <a class="code" href="classrdmnet_1_1_dynamic_uid_assignment_list.html">rdmnet::DynamicUidAssignmentList</a>&amp; list)</div><div class="line">{</div><div class="line">  <span class="comment">// Check handles as necessary...</span></div><div class="line"></div><div class="line">  <span class="keywordflow">for</span> (<span class="keyword">const</span> <a class="code" href="structrdmnet_1_1_dynamic_uid_mapping.html">rdmnet::DynamicUidMapping</a>&amp; mapping : list.<a class="code" href="classrdmnet_1_1_dynamic_uid_assignment_list.html#adcbcc8c9912e129b23d55e15565433d6">GetMappings</a>())</div><div class="line">  {</div><div class="line">    <span class="keywordflow">if</span> (mapping.IsOk())</div><div class="line">    {</div><div class="line">      <span class="comment">// This function is assumed to add the RID to the responder&#39;s cached data.</span></div><div class="line">      AddResponderRid(mapping.uid, mapping.rid);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;Error obtaining RID for responder &quot;</span> &lt;&lt; mapping.uid.ToString() &lt;&lt; <span class="stringliteral">&quot;: &#39;&quot;</span></div><div class="line">                &lt;&lt; mapping.CodeToString() &lt;&lt; <span class="stringliteral">&quot;&#39;\n&quot;</span>;</div><div class="line">    }</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p> 
</div>
</p>
<h2>Handling RDM Commands</h2>
<p>In addition to getting information about responders, RDMnet controllers are required to respond to a basic set of RDM commands, which allows them to be identified by other controllers on the network. By default, this behavior is implemented completely within the library.</p>
<p>The default implementation provides read-only access to the standard set of data that is required to be readable from a controller. This includes the current scope(s) (<code>COMPONENT_SCOPE</code>), search domain (<code>SEARCH_DOMAIN</code>), and RDMnet communication diagnostic data (<code>TCP_COMMS_STATUS</code>), as well as some basic RDM data like the manufacturer (<code>MANUFACTURER_LABEL</code>), a description of the product (<code>DEVICE_MODEL_DESCRIPTION</code>), the software version in string form (<code>SOFTWARE_VERSION_LABEL</code>) and a user-settable label for the controller (<code>DEVICE_LABEL</code>). The library has access to all the information necessary for the first three items, since that information is necessary for RDMnet communication. Initial values for the last four items are provided to the library when creating a new controller instance, through the <a class="el" href="group__rdmnet__controller.html#gabe33db1a11bf3b2b14e7c7a51f612a42" title="Provide a set of basic information that the library will use for responding to RDM commands...">rdmnet_controller_set_rdm_data()</a> function or the <a class="el" href="structrdmnet_1_1_controller_1_1_rdm_data.html" title="A set of initial identifying RDM data to use for a controller. ">rdmnet::Controller::RdmData</a> structure.</p>
<p>If you want to provide richer RDM responder functionality from your controller implementation, you can provide a set of callbacks to handle RDM commands. In this case, the library will no longer handle any RDM commands on your behalf and you must handle all of the above PIDs, as well as <code>SUPPORTED_PARAMETERS</code> and any additional ones you choose to support.</p>
<p>To use the library this way, you can:</p>
<p> 
<div class="tab">
  <button id="button_13_c" class="tablinks" onclick="selectLanguage(event, '13', 'c')">C</button>
  <button id="button_13_cpp" class="tablinks" onclick="selectLanguage(event, '13', 'cpp')">C++</button>
</div>
<div id="div_13_c" class="tabcontent">
</p>
<div class="fragment"><div class="line"><a class="code" href="struct_rdmnet_controller_config.html">RdmnetControllerConfig</a> config = <a class="code" href="group__rdmnet__controller.html#gab61905ff5228301100c6d70c58e77661">RDMNET_CONTROLLER_CONFIG_DEFAULT_INIT</a>(MY_ESTA_MANUFACTURER_ID_VAL);</div><div class="line"></div><div class="line"><span class="comment">// Generate CID and call rdmnet_controller_set_callbacks() as above...</span></div><div class="line"></div><div class="line"><a class="code" href="group__rdmnet__controller.html#ga93c798fdaf4d9fc3f97fab91605db300">rdmnet_controller_set_rdm_cmd_callbacks</a>(&amp;config, my_rdm_command_received_cb, my_llrp_rdm_command_received_cb);</div><div class="line"></div><div class="line"><a class="code" href="group__rdmnet__controller.html#gae857478c160127b99ef4c092ac608fcb">rdmnet_controller_t</a> my_controller_handle;</div><div class="line"><a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/group__etcpal__error.html#ga743b0648f0ca798ef29c9f69c6e255af">etcpal_error_t</a> result = <a class="code" href="group__rdmnet__controller.html#ga1860f48d433795826ce3edc8f6963c51">rdmnet_controller_create</a>(&amp;config, &amp;my_controller_handle);</div></div><!-- fragment --><p> 
</div>
<div id="div_13_cpp" class="tabcontent">
</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>MyControllerRdmCommandHandler : <span class="keyword">public</span> <a class="code" href="classrdmnet_1_1_controller_1_1_rdm_command_handler.html">rdmnet::Controller::RdmCommandHandler</a></div><div class="line">{</div><div class="line">  <span class="comment">// Implement the RdmCommandHandler functions...</span></div><div class="line">};</div><div class="line"></div><div class="line">MyControllerRdmCommandHandler my_rdm_cmd_handler;</div><div class="line"><a class="code" href="structrdmnet_1_1_controller_1_1_settings.html">rdmnet::Controller::Settings</a> my_settings(my_cid, MY_ESTA_MANUFACTURER_ID_VAL);</div><div class="line"></div><div class="line"><a class="codeRef" doxygen="/home/vsts/work/1/s/external/EtcPal/docs/etcpal.tag:https://etclabs.github.io/EtcPal/docs/head/" href="https://etclabs.github.io/EtcPal/docs/head/classetcpal_1_1_error.html">etcpal::Error</a> result = controller.<a class="code" href="classrdmnet_1_1_controller.html#a1d0150d73e64cfff241b351f7b8efd55">Startup</a>(my_controller_notify_handler, my_settings, my_rdm_cmd_handler);</div></div><!-- fragment --><p> 
</div>
</p>
<p>See <a class="el" href="handling_rdm_commands.html">Handling RDM Commands</a> for information about how to handle commands through the callbacks. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="getting_started.html">Getting Started</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
