<!-- HTML header for doxygen 1.8.14-->
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=9" />
  <meta name="generator" content="Doxygen 1.8.13" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RDMnet: Handling RDM Commands</title>
  <link href="tabs.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="jquery.js"></script>
  <script type="text/javascript" src="dynsections.js"></script>
  <link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
  <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
  <link href="stylesheet.css" rel="stylesheet" type="text/css" />
  <!--BEGIN CUSTOM SCRIPTS-->
  <script type="text/javascript">
    $(function () {
      $.get('/RDMnet/docs/versions.txt', function (data) {
        if (data) {
          var lines = data.split('\n');
          if (lines.length > 0) {
            var version_select = $("#version_select").empty();
            lines.forEach(function (line) {
              line = line.trim();
              if (!line) {
                return;
              }
              line = line.split(':');
              var option_name = line[0].replace(/^v/, '');
              if (line.length > 1) {
                option_name += ' (' + line[1] + ')';
              }
              var option_val = '/RDMnet/docs/' + line[0];
              var option = $('<option></option>').attr("value", option_val)
                .text(option_name);
              if (window.location.pathname.match('docs/' + line[0])) {
                option = option.attr("selected", "selected");
              }
              version_select.append(option);
            });
          }
        }
      }, 'text');
    });
  </script>
  <script type="text/javascript">
    $(function () { selectAllC() });
  </script>
  <script type="text/javascript">
    function selectAllC() {
      // Enable all C-language blocks
      var tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
        if (tabcontent[i].id.endsWith("_c")) {
          tabcontent[i].style.display = "block";
        } else {
          tabcontent[i].style.display = "none"
        }
      }
      // Enable all C-language buttons
      var tablinks = document.getElementsByClassName("tablinks");
      for (i = 0; i < tablinks.length; i++) {
        if (tablinks[i].id.endsWith("_c")) {
          if (!tablinks[i].className.includes("active")) {
            tablinks[i].className = tablinks[i].className += " active";
          }
        } else {
          tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
      }
    }
    function selectAllCpp() {
      // Enable all C++-language blocks
      var tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
        if (tabcontent[i].id.endsWith("_cpp")) {
          tabcontent[i].style.display = "block";
        } else {
          tabcontent[i].style.display = "none"
        }
      }
      // Enable all C++-language buttons
      var tablinks = document.getElementsByClassName("tablinks");
      for (i = 0; i < tablinks.length; i++) {
        if (tablinks[i].id.endsWith("_cpp")) {
          if (!tablinks[i].className.includes("active")) {
            tablinks[i].className = tablinks[i].className += " active";
          }
        } else {
          tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
      }
    }
    function selectLanguage(evt, block_id, language) {
      // Get all elements with class="tabcontent" and hide them
      var tabcontent = document.getElementsByClassName("tabcontent");
      for (i = 0; i < tabcontent.length; i++) {
        if (tabcontent[i].id.startsWith("div_" + block_id)) {
          tabcontent[i].style.display = "none";
        }
      }
      // Get all elements with class="tablinks" and remove the class "active"
      var tablinks = document.getElementsByClassName("tablinks");
      for (i = 0; i < tablinks.length; i++) {
        if (tablinks[i].id.startsWith("button_" + block_id)) {
          tablinks[i].className = tablinks[i].className.replace(" active", "");
        }
      }
      // Show the current tab, and add an "active" class to the button that opened the tab
      document.getElementById("div_" + block_id + "_" + language).style.display = "block";
      if (!evt.currentTarget.className.includes("active")) {
        evt.currentTarget.className += " active";
      }
    }
  </script>
  <!--END CUSTOM SCRIPT-->
</head>
<body>
  <div id="top">
    <!-- do not remove this div, it is closed by doxygen! -->
    <div id="titlearea">
      <table cellspacing="0" cellpadding="0" style="width: 100%">
        <tbody>
          <tr style="height: 56px;">
            <td id="projectalign" style="padding-left: 0.5em;">
              <div id="projectname">RDMnet
                &#160;<span id="projectnumber">Staging for pull request 34</span>
              </div>
              <div id="projectbrief">Implementation of ANSI E1.33 (RDMnet)</div>
            </td>
            <!--BEGIN CUSTOM INSERTED SECTION-->
            <td style="text-align: right; padding-right: 0.5em">
              <div id="otherversions">
                View other versions:
                <select id="version_select" onchange="location = this.value">
                </select>
              </div>
            </td>
            <!--END CUSTOM INSERTED SECTION-->
          </tr>
        </tbody>
      </table>
    </div>
    <!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('handling_rdm_commands.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Handling RDM Commands </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p> 
<div class="tab">
  <button id="button_1_c" class="tablinks" onclick="selectAllC()">Show All C Snippets</button>
  <button id="button_1_cpp" class="tablinks" onclick="selectAllCpp()">Show All C++ Snippets</button>
</div>
</p>
<p>Handling and responding to RDM commands is the core functionality of RDMnet devices and gateways, and an optional part of the functionality of RDMnet controllers.</p>
<h2>Interpreting RDM Commands</h2>
<p>RDM commands are delivered via a callback that looks like the below:</p>
<p> 
<div class="tab">
  <button id="button_2_c" class="tablinks" onclick="selectLanguage(event, '2', 'c')">C</button>
  <button id="button_2_cpp" class="tablinks" onclick="selectLanguage(event, '2', 'cpp')">C++</button>
</div>
<div id="div_2_c" class="tabcontent">
</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> rdm_command_received(<a class="code" href="group__rdmnet__device.html#gad17bb8836a86ad4c8a774cd94a01d63c">rdmnet_device_t</a> handle, <span class="keyword">const</span> <a class="code" href="struct_rdmnet_rdm_command.html">RdmnetRdmCommand</a>* cmd, <a class="code" href="struct_rdmnet_sync_rdm_response.html">RdmnetSyncRdmResponse</a>* response,</div><div class="line">                          <span class="keywordtype">void</span>* context)</div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (<a class="code" href="group__rdmnet__api__common.html#gaacb0f33f5d6610d7ce65b7debccfccd0">RDMNET_COMMAND_IS_TO_DEFAULT_RESPONDER</a>(cmd))</div><div class="line">  {</div><div class="line">    <span class="comment">// Handle the command with the default responder.</span></div><div class="line">  }</div><div class="line">  <span class="keywordflow">else</span></div><div class="line">  {</div><div class="line">    <span class="comment">// Command is addressed to a non-default virtual or physical RDM responder.</span></div><div class="line">    <span class="comment">// Inspect cmd-&gt;dest_endpoint and cmd-&gt;rdm_header.dest_uid to determine which one.</span></div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p> 
</div>
<div id="div_2_cpp" class="tabcontent">
</p>
<div class="fragment"><div class="line">rdmnet::ResponseAction MyRdmnetNotifyHander::HandleRdmCommand(<a class="code" href="classrdmnet_1_1_device.html#a7e0d6654da08564c996e6518ebe5def9">rdmnet::Device::Handle</a> handle,</div><div class="line">                                                              <span class="keyword">const</span> <a class="code" href="classrdmnet_1_1_rdm_command.html">rdmnet::RdmCommand</a>&amp; cmd)</div><div class="line">{</div><div class="line">  <span class="keywordflow">if</span> (cmd.<a class="code" href="classrdmnet_1_1_rdm_command.html#a18ab3142115df0d52a43673c8af4527e">IsToDefaultResponder</a>())</div><div class="line">  {</div><div class="line">    <span class="comment">// Handle the command with the default responder.</span></div><div class="line">  }</div><div class="line">  <span class="keywordflow">else</span></div><div class="line">  {</div><div class="line">    <span class="comment">// Command is addressed to a non-default virtual or physical RDM responder.</span></div><div class="line">    <span class="comment">// Inspect cmd.dest_endpoint() and cmd.rdm_dest_uid() to determine which one.</span></div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p> 
</div>
</p>
<p>An RDM command in RDMnet can be addressed to the default responder or a sub-responder (see <a class="el" href="devices_and_gateways.html">Devices and Gateways</a> for more information on these concepts). A command to the default responder addresses the RDM parameters of the device implementing RDMnet. A command to a sub-responder addresses either a portion of the device's functionality dedicated to handling sACN (a virtual responder) or a physical RDM responder connected to an RDMnet gateway.</p>
<p>Besides this special RDMnet addressing information, the RDM command structure delivered with the RDM command handler callback contains data typical to RDM handling logic; the command class, parameter ID, subdevice ID, and parameter data, if any. The only other RDMnet-specific construct is the sequence number, which is only used internally by the library.</p>
<h2>Responding to RDM Commands</h2>
<p>This RDMnet library allows two different paradigms for responding to RDM commands: synchronous and asynchronous. The RDMnet Device API will be used as an example, but this also applies to the Controller API if using the RDM responder callbacks.</p>
<p>By the time this callback is called, the library will already have handled some error conditions internally. For example, if the received RDMnet RDM command was malformed, or not addressed to the local RDMnet component, the message will be dropped or an error response will be sent according to the rules of the RDMnet standard.</p>
<h3>Responding synchronously</h3>
<p>If you can access the data needed to respond to the RDM command relatively quickly from the code path of the notification callback, it's convenient to respond synchronously. The RDM command notification callbacks provide a way to set the response information directly from the callback, which the library will use to send a response after the callback returns.</p>
<p><em>Important note: Do not do this when accessing response data may block for a significant time.</em> See "Responding asynchronously" below for that scenario.</p>
<p>There are two different ways to respond synchronously to an RDM command received over RDMnet:</p>
<h4>ACK (ACKnowledge)</h4>
<p>An ACK response indicates that the action in the command was carried out. ACK responses can contain data; for example, the responses to most RDM GET commands contain data that was requested by a controller. When an ACK response contains data, it should be copied into the buffer that was provided when the RDMnet handle was created, before returning from the callback function. All notifications for any given RDMnet handle are delivered from the same thread, so accesses to this buffer from the callback context are thread-safe.</p>
<p>After copying the data, use the API-specific method to indicate that this is an ACK response as shown below.</p>
<p> 
<div class="tab">
  <button id="button_3_c" class="tablinks" onclick="selectLanguage(event, '3', 'c')">C</button>
  <button id="button_3_cpp" class="tablinks" onclick="selectLanguage(event, '3', 'cpp')">C++</button>
</div>
<div id="div_3_c" class="tabcontent">
</p>
<div class="fragment"><div class="line"><span class="comment">// This buffer was provided as part of the RdmnetDeviceConfig when the device handle was created.</span></div><div class="line"><span class="keyword">static</span> uint8_t my_rdmnet_response_buf[MY_MAX_RESPONSE_SIZE];</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> rdm_command_received(<a class="code" href="group__rdmnet__device.html#gad17bb8836a86ad4c8a774cd94a01d63c">rdmnet_device_t</a> handle, <span class="keyword">const</span> <a class="code" href="struct_rdmnet_rdm_command.html">RdmnetRdmCommand</a>* cmd, <a class="code" href="struct_rdmnet_sync_rdm_response.html">RdmnetSyncRdmResponse</a>* response,</div><div class="line">                          <span class="keywordtype">void</span>* context)</div><div class="line">{</div><div class="line">  <span class="comment">// Very simplified example...</span></div><div class="line">  <span class="keywordflow">if</span> (cmd-&gt;<a class="code" href="struct_rdmnet_rdm_command.html#a5465508fc1c33985e0b9525573644f05">rdm_header</a>.<a class="codeRef" doxygen="/home/vsts/work/1/s/external/RDM/docs/RDM.tag:https://etclabs.github.io/RDM/docs/head/" href="https://etclabs.github.io/RDM/docs/head/struct_rdm_command_header.html#a8627e24459da221d560b593ea2d9f5f6">command_class</a> == <a class="codeRef" doxygen="/home/vsts/work/1/s/external/RDM/docs/RDM.tag:https://etclabs.github.io/RDM/docs/head/" href="https://etclabs.github.io/RDM/docs/head/group__message.html#ggafda6b6d4c08788e755cb3cb6c1ca021ba434701b28c3c83f9230b5da6d54e26ab">kRdmCCGetCommand</a> &amp;&amp; cmd-&gt;<a class="code" href="struct_rdmnet_rdm_command.html#a5465508fc1c33985e0b9525573644f05">rdm_header</a>.<a class="codeRef" doxygen="/home/vsts/work/1/s/external/RDM/docs/RDM.tag:https://etclabs.github.io/RDM/docs/head/" href="https://etclabs.github.io/RDM/docs/head/struct_rdm_command_header.html#a43f5e73445b99b42061429682fdc78fc">param_id</a> == E120_DEVICE_INFO)</div><div class="line">  {</div><div class="line">    memcpy(my_rdmnet_response_buf, kMyDeviceInfoData, DEVICE_INFO_DATA_SIZE);</div><div class="line">    <a class="code" href="group__rdmnet__api__common.html#gaf4ea2570562bd8f38159f2d7413ca188">RDMNET_SYNC_SEND_RDM_ACK</a>(response, DEVICE_INFO_DATA_SIZE);</div><div class="line">    <span class="comment">// ACK will be sent after this function returns.</span></div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p> 
</div>
<div id="div_3_cpp" class="tabcontent">
</p>
<div class="fragment"><div class="line"><span class="comment">// This buffer was provided as part of the Device::Settings when the Device instance was</span></div><div class="line"><span class="comment">// initialized.</span></div><div class="line"><span class="keyword">static</span> uint8_t my_rdmnet_response_buf[kMyMaxResponseSize];</div><div class="line"></div><div class="line"><a class="code" href="classrdmnet_1_1_rdm_response_action.html">rdmnet::RdmResponseAction</a> MyRdmnetNotifyHander::HandleRdmCommand(<a class="code" href="classrdmnet_1_1_device.html#a7e0d6654da08564c996e6518ebe5def9">rdmnet::Device::Handle</a> handle,</div><div class="line">                                                                 <span class="keyword">const</span> <a class="code" href="classrdmnet_1_1_rdm_command.html">rdmnet::RdmCommand</a>&amp; cmd)</div><div class="line">{</div><div class="line">  <span class="comment">// Very simplified example...</span></div><div class="line">  <span class="keywordflow">if</span> (cmd.<a class="code" href="classrdmnet_1_1_rdm_command.html#af01ca868e13240d0a4ddb07f82d9907e">IsGet</a>() &amp;&amp; cmd.<a class="code" href="classrdmnet_1_1_rdm_command.html#a63629cb9cb2169388593a9161a32c72f">param_id</a>() == E120_DEVICE_INFO)</div><div class="line">  {</div><div class="line">    std::memcpy(my_rdmnet_response_buf, kMyDeviceInfoData, kDeviceInfoDataSize);</div><div class="line">    <span class="keywordflow">return</span> <a class="code" href="classrdmnet_1_1_rdm_response_action.html#a66301810814d353b92754a177d92dcaa">rdmnet::RdmResponseAction::SendAck</a>(kDeviceInfoDataSize);</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p> 
</div>
</p>
<p>Most SET commands don't require data in their ACK response; the response is just an acknowledgment that the changed parameter was acted upon. In this case, there's no need to copy any data before responding with an ACK.</p>
<p> 
<div class="tab">
  <button id="button_4_c" class="tablinks" onclick="selectLanguage(event, '4', 'c')">C</button>
  <button id="button_4_cpp" class="tablinks" onclick="selectLanguage(event, '4', 'cpp')">C++</button>
</div>
<div id="div_4_c" class="tabcontent">
</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> rdm_command_received(<a class="code" href="group__rdmnet__device.html#gad17bb8836a86ad4c8a774cd94a01d63c">rdmnet_device_t</a> handle, <span class="keyword">const</span> <a class="code" href="struct_rdmnet_rdm_command.html">RdmnetRdmCommand</a>* cmd, <a class="code" href="struct_rdmnet_sync_rdm_response.html">RdmnetSyncRdmResponse</a>* response,</div><div class="line">                          <span class="keywordtype">void</span>* context)</div><div class="line">{</div><div class="line">  <span class="comment">// Very simplified example...</span></div><div class="line">  <span class="keywordflow">if</span> (cmd-&gt;<a class="code" href="struct_rdmnet_rdm_command.html#a5465508fc1c33985e0b9525573644f05">rdm_header</a>.<a class="codeRef" doxygen="/home/vsts/work/1/s/external/RDM/docs/RDM.tag:https://etclabs.github.io/RDM/docs/head/" href="https://etclabs.github.io/RDM/docs/head/struct_rdm_command_header.html#a8627e24459da221d560b593ea2d9f5f6">command_class</a> == <a class="codeRef" doxygen="/home/vsts/work/1/s/external/RDM/docs/RDM.tag:https://etclabs.github.io/RDM/docs/head/" href="https://etclabs.github.io/RDM/docs/head/group__message.html#ggafda6b6d4c08788e755cb3cb6c1ca021baf16a0108fda7d3470eb281147527ddbf">kRdmCCSetCommand</a> &amp;&amp; cmd-&gt;<a class="code" href="struct_rdmnet_rdm_command.html#a5465508fc1c33985e0b9525573644f05">rdm_header</a>.<a class="codeRef" doxygen="/home/vsts/work/1/s/external/RDM/docs/RDM.tag:https://etclabs.github.io/RDM/docs/head/" href="https://etclabs.github.io/RDM/docs/head/struct_rdm_command_header.html#a43f5e73445b99b42061429682fdc78fc">param_id</a> == E120_IDENTIFY_DEVICE)</div><div class="line">  {</div><div class="line">    <span class="keywordflow">if</span> (cmd-&gt;<a class="code" href="struct_rdmnet_rdm_command.html#acb25f5e5453fa1cfc61647dcf8fa1d82">data</a>[0] == 0)</div><div class="line">    {</div><div class="line">      <span class="comment">// Stop the physical identify operation</span></div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">      <span class="comment">// Start the physical identify operation</span></div><div class="line">    }</div><div class="line">    <span class="comment">// Indicate an ACK should be sent with no data.</span></div><div class="line">    <a class="code" href="group__rdmnet__api__common.html#gaf4ea2570562bd8f38159f2d7413ca188">RDMNET_SYNC_SEND_RDM_ACK</a>(response, 0);</div><div class="line">    <span class="comment">// ACK will be sent after this function returns.</span></div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p> 
</div>
<div id="div_4_cpp" class="tabcontent">
</p>
<div class="fragment"><div class="line"><a class="code" href="classrdmnet_1_1_rdm_response_action.html">rdmnet::RdmResponseAction</a> MyRdmnetNotifyHander::HandleRdmCommand(<a class="code" href="classrdmnet_1_1_device.html#a7e0d6654da08564c996e6518ebe5def9">rdmnet::Device::Handle</a> handle,</div><div class="line">                                                                 <span class="keyword">const</span> <a class="code" href="classrdmnet_1_1_rdm_command.html">rdmnet::RdmCommand</a>&amp; cmd)</div><div class="line">{</div><div class="line">  <span class="comment">// Very simplified example...</span></div><div class="line">  <span class="keywordflow">if</span> (cmd.<a class="code" href="classrdmnet_1_1_rdm_command.html#a1ba8dc7d0870637e96d7d2882305cc83">IsSet</a>() &amp;&amp; cmd.<a class="code" href="classrdmnet_1_1_rdm_command.html#a63629cb9cb2169388593a9161a32c72f">param_id</a>() == E120_IDENTIFY_DEVICE)</div><div class="line">  {</div><div class="line">    <span class="keywordflow">if</span> (cmd.<a class="code" href="classrdmnet_1_1_rdm_command.html#af91050edbb54819c0cefa6a5483a3e00">data</a>()[0] == 0)</div><div class="line">    {</div><div class="line">      <span class="comment">// Stop the physical identify operation</span></div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">      <span class="comment">// Start the physical identify operation</span></div><div class="line">    }</div><div class="line">    <span class="comment">// Indicate an ACK should be sent with no data.</span></div><div class="line">    <span class="keywordflow">return</span> <a class="code" href="classrdmnet_1_1_rdm_response_action.html#a66301810814d353b92754a177d92dcaa">rdmnet::RdmResponseAction::SendAck</a>();</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p> 
</div>
</p>
<h4>NACK (Negative ACKnowledge)</h4>
<p>A NACK response indicates that the RDMnet command was valid, but the RDM transaction cannot be acted upon for some reason. NACK responses contain a reason code that indicates the reason that the command cannot be acted upon. Common reasons to NACK an RDMnet RDM command include:</p>
<ul>
<li>The given RDM Parameter ID (PID) is not supported by this responder (<a class="elRef" doxygen="/home/vsts/work/1/s/external/RDM/docs/RDM.tag:https://etclabs.github.io/RDM/docs/head/" href="https://etclabs.github.io/RDM/docs/head/group__message.html#ggaa11fc36923818f02895f40dafd228474a9ff3ed335721af7014435875e1e46e95">kRdmNRUnknownPid</a>)</li>
<li>The PID is supported, but the requested command class is not (<a class="elRef" doxygen="/home/vsts/work/1/s/external/RDM/docs/RDM.tag:https://etclabs.github.io/RDM/docs/head/" href="https://etclabs.github.io/RDM/docs/head/group__message.html#ggaa11fc36923818f02895f40dafd228474a119433ed2edf83096329be3d4e87b25f">kRdmNRUnsupportedCommandClass</a>)<ul>
<li>Example: a SET was requested on a read-only parameter</li>
</ul>
</li>
<li>Some data present in the command contains an index that is out of range (<a class="elRef" doxygen="/home/vsts/work/1/s/external/RDM/docs/RDM.tag:https://etclabs.github.io/RDM/docs/head/" href="https://etclabs.github.io/RDM/docs/head/group__message.html#ggaa11fc36923818f02895f40dafd228474a98240ffd8525a507a932d7672bc8d9f3">kRdmNRDataOutOfRange</a>)<ul>
<li>Example: a device has 3 sensors and a GET:SENSOR_VALUE command was received for sensor number 4</li>
</ul>
</li>
</ul>
<p>To respond with a NACK, use the API-specific method to indicate that this is a NACK response and provide the reason as shown below.</p>
<p> 
<div class="tab">
  <button id="button_5_c" class="tablinks" onclick="selectLanguage(event, '5', 'c')">C</button>
  <button id="button_5_cpp" class="tablinks" onclick="selectLanguage(event, '5', 'cpp')">C++</button>
</div>
<div id="div_5_c" class="tabcontent">
</p>
<div class="fragment"><div class="line"><span class="comment">// Called from rdm_command_received()</span></div><div class="line"><span class="keywordtype">void</span> handle_get_sensor_value(<a class="code" href="group__rdmnet__device.html#gad17bb8836a86ad4c8a774cd94a01d63c">rdmnet_device_t</a> handle, <span class="keyword">const</span> uint8_t* data, <a class="code" href="struct_rdmnet_sync_rdm_response.html">RdmnetSyncRdmResponse</a>* response)</div><div class="line">{</div><div class="line">  uint8_t sensor_num = data[0];</div><div class="line">  <span class="keywordflow">if</span> (sensor_num &gt;= NUM_SENSORS)</div><div class="line">  {</div><div class="line">    <a class="code" href="group__rdmnet__api__common.html#ga91e96da81698ff84a605e9c21fdc46b3">RDMNET_SYNC_SEND_RDM_NACK</a>(response, <a class="codeRef" doxygen="/home/vsts/work/1/s/external/RDM/docs/RDM.tag:https://etclabs.github.io/RDM/docs/head/" href="https://etclabs.github.io/RDM/docs/head/group__message.html#ggaa11fc36923818f02895f40dafd228474a98240ffd8525a507a932d7672bc8d9f3">kRdmNRDataOutOfRange</a>);</div><div class="line">    <span class="comment">// NACK will be sent after the RDM command handler callback returns.</span></div><div class="line">  }</div><div class="line">  <span class="keywordflow">else</span></div><div class="line">  {</div><div class="line">    <span class="comment">// Process data and send ack...</span></div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p> 
</div>
<div id="div_5_cpp" class="tabcontent">
</p>
<div class="fragment"><div class="line"><span class="comment">// Called from MyRdmnetNotifyHandler::HandleRdmCommand()</span></div><div class="line"><a class="code" href="classrdmnet_1_1_rdm_response_action.html">rdmnet::RdmResponseAction</a> MyRdmnetNotifyHander::HandleGetSensorValue(<span class="keyword">const</span> uint8_t* data)</div><div class="line">{</div><div class="line">  uint8_t sensor_num = data[0];</div><div class="line">  <span class="keywordflow">if</span> (sensor_num &gt;= NUM_SENSORS)</div><div class="line">  {</div><div class="line">    <span class="keywordflow">return</span> <a class="code" href="classrdmnet_1_1_rdm_response_action.html#a0f084460d0d89d9af564dd573720d251">rdmnet::RdmResponseAction::SendNack</a>(<a class="codeRef" doxygen="/home/vsts/work/1/s/external/RDM/docs/RDM.tag:https://etclabs.github.io/RDM/docs/head/" href="https://etclabs.github.io/RDM/docs/head/group__message.html#ggaa11fc36923818f02895f40dafd228474a98240ffd8525a507a932d7672bc8d9f3">kRdmNRDataOutOfRange</a>);</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p> 
</div>
</p>
<h3>Responding asynchronously</h3>
<p>If you choose to defer the response to an RDM command to be sent at a later time, you <em>must</em> ensure that every RDM command gets a response eventually (one of ACK, NACK or RPT Status).</p>
<h4>RPT Status</h4>
<p>An RPT Status response is an RDMnet protocol level response to an RDM command. Most RPT Status messages (except <a class="el" href="group__rdmnet__api__common.html#ggaa9aca0658bfae057363a520c0d9907c2ac057a735905bfc371c7a577a2583a922">kRptStatusBroadcastComplete</a>) indicate that something has gone wrong at the RDMnet protocol level and the request cannot be handled. RPT Status responses include a code that indicates the reason for the status message.</p>
<p>Most conditions that would require sending an RPT Status are handled at the library level. The ones that must be handled by the application relate exclusively to the operation of RDMnet Gateways. RPT Status codes that need to be handled by a gateway application include:</p>
<ul>
<li>A gateway encountered an RDM timeout while attempting to forward an RDM command to a responder (<a class="el" href="group__rdmnet__api__common.html#ggaa9aca0658bfae057363a520c0d9907c2a08699760f9bff1a12623953eb3ca513b">kRptStatusRdmTimeout</a>)</li>
<li>A gateway received an invalid RDM response from a responder (<a class="el" href="group__rdmnet__api__common.html#ggaa9aca0658bfae057363a520c0d9907c2aacb7604870f3fafd5847d235ec8cbc1f">kRptStatusInvalidRdmResponse</a>)</li>
<li>A gateway has finished transmitting an RDM broadcast message on a port (<a class="el" href="group__rdmnet__api__common.html#ggaa9aca0658bfae057363a520c0d9907c2ac057a735905bfc371c7a577a2583a922">kRptStatusBroadcastComplete</a>)</li>
</ul>
<h4>Saving Commands</h4>
<p>The RDM command structures delivered to callbacks by the RDMnet library reference data that is kept in buffers owned by the library, and will be reused for other data when that callback returns. In order to defer responses to RDM commands to be sent later, it's necessary to save the command data to be sent along with its corresponding response.</p>
<p>RDMnet provides APIs for saving the command into different structs and/or classes which contain data buffers to hold the RDM parameter data.</p>
<p> 
<div class="tab">
  <button id="button_6_c" class="tablinks" onclick="selectLanguage(event, '6', 'c')">C</button>
  <button id="button_6_cpp" class="tablinks" onclick="selectLanguage(event, '6', 'cpp')">C++</button>
</div>
<div id="div_6_c" class="tabcontent">
</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> rdm_command_received(<a class="code" href="group__rdmnet__device.html#gad17bb8836a86ad4c8a774cd94a01d63c">rdmnet_device_t</a> handle, <span class="keyword">const</span> <a class="code" href="struct_rdmnet_rdm_command.html">RdmnetRdmCommand</a>* cmd, <a class="code" href="struct_rdmnet_sync_rdm_response.html">RdmnetSyncRdmResponse</a>* response,</div><div class="line">                          <span class="keywordtype">void</span>* context)</div><div class="line">{ </div><div class="line">  <span class="comment">// Note that this type contains a byte array large enough for the largest possible RDM command</span></div><div class="line">  <span class="comment">// data buffer, e.g. 231 bytes.</span></div><div class="line">  <a class="code" href="struct_rdmnet_saved_rdm_command.html">RdmnetSavedRdmCommand</a> saved_cmd;</div><div class="line">  <a class="code" href="group__rdmnet__api__common.html#ga5d5b5c221b97833f4480af01b05ca02d">rdmnet_save_rdm_command</a>(cmd, &amp;saved_cmd);</div><div class="line"></div><div class="line">  <span class="comment">// Add saved_cmd to some memory location to be used later...</span></div><div class="line"></div><div class="line">  <a class="code" href="group__rdmnet__api__common.html#gae50ccf46c68476302b14c450929ba43d">RDMNET_SYNC_DEFER_RDM_RESPONSE</a>(response);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// Later, when the response is available...</span></div><div class="line"><a class="code" href="group__rdmnet__device.html#gace1ea6c76a6b3f441c1f7ccaa27e9aa6">rdmnet_device_send_rdm_ack</a>(my_device_handle, &amp;saved_cmd, response_data, response_data_len);</div></div><!-- fragment --><p> 
</div>
<div id="div_6_cpp" class="tabcontent">
</p>
<div class="fragment"><div class="line"><a class="code" href="classrdmnet_1_1_rdm_response_action.html">rdmnet::RdmResponseAction</a> MyRdmnetNotifyHander::HandleRdmCommand(<a class="code" href="classrdmnet_1_1_device.html#a7e0d6654da08564c996e6518ebe5def9">rdmnet::Device::Handle</a> handle,</div><div class="line">                                                                 <span class="keyword">const</span> <a class="code" href="classrdmnet_1_1_rdm_command.html">rdmnet::RdmCommand</a>&amp; cmd)</div><div class="line">{</div><div class="line">  <span class="comment">// Note that this type contains a byte array large enough for the largest possible RDM command</span></div><div class="line">  <span class="comment">// data buffer, e.g. 231 bytes.</span></div><div class="line">  <a class="code" href="classrdmnet_1_1_saved_rdm_command.html">rdmnet::SavedRdmCommand</a> saved_cmd = cmd.<a class="code" href="classrdmnet_1_1_rdm_command.html#a78e3d10f3f539e2314643d7017a6beb7">Save</a>();</div><div class="line"></div><div class="line">  <span class="comment">// Add saved_cmd to some memory location to be used later...</span></div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> <a class="code" href="classrdmnet_1_1_rdm_response_action.html#ae84cb7af11813b1ccadd00b167ceff62">rdmnet::RdmResponseAction::DeferResponse</a>();</div><div class="line">}</div><div class="line"></div><div class="line"><span class="comment">// Later, when the response is available...</span></div><div class="line">my_device.SendRdmAck(saved_cmd, response_data, response_data_len);</div></div><!-- fragment --><p> 
</div>
</p>
<h2>PIDs handled by the library</h2>
<p>The RDMnet library has all the information necessary to handle certain RDMnet-related RDM commands internally with no intervention by the application. The list of PIDs fully handled by the RDMnet library are:</p>
<ul>
<li>ANSI E1.37-7<ul>
<li>ENDPOINT_LIST</li>
<li>ENDPOINT_LIST_CHANGE</li>
<li>ENDPOINT_RESPONDERS</li>
<li>ENDPOINT_RESPONDER_LIST_CHANGE</li>
</ul>
</li>
<li>ANSI E1.33<ul>
<li>TCP_COMMS_STATUS</li>
<li>BROKER_STATUS<ul>
<li>Will be handled according to the policies given in the broker's settings configuration.</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>The list of PIDS partially handled by the library are:</p>
<ul>
<li>ANSI E1.33<ul>
<li>COMPONENT_SCOPE<ul>
<li>GETs for this PID are handled by the library.</li>
<li>SETs for this PID are forwarded to the application for handling. If the application ACKs the SET command, the library will act on the new scope configuration (disconnecting and reconnecting as necessary).</li>
</ul>
</li>
<li>SEARCH_DOMAIN<ul>
<li>GETs for this PID are handled by the library.</li>
<li>SETs for this PID are fowarded to the application for handling. If the application ACKs the SET command, the library will act on the new search domain configuration (disconnecting and reconnecting as necessary).</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>There is no need to include these PID values in your response to the GET:SUPPORTED_PARAMETERS command; they will be automatically added by the library before sending the response. </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="getting_started.html">Getting Started</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
